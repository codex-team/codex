{"version":3,"sources":["webpack:///webpack/bootstrap f6333665d8658a836b93","webpack:///./index.js","webpack:///./editor.js","webpack:///./modules/core.js","webpack:///./modules/ui.js","webpack:///./modules/transport.js","webpack:///./modules/renderer.js","webpack:///./modules/saver.js","webpack:///./modules/content.js","webpack:///./modules/toolbar/toolbar.js","webpack:///./modules/toolbar/settings.js","webpack:///./modules/toolbar/inline.js","webpack:///./modules/toolbar/toolbox.js","webpack:///./modules/tools.js","webpack:///./modules/plugins/paragraph/paragraph.js","webpack:///./modules/plugins/paragraph/paragraph.css","webpack:///./modules/plugins/code/code.js","webpack:///./modules/plugins/code/code.css","webpack:///./modules/plugins/link/link.js","webpack:///./modules/plugins/link/link.css","webpack:///./modules/plugins/list/list.js","webpack:///./modules/plugins/list/list.css","webpack:///./modules/plugins/quote/quote.js","webpack:///./modules/plugins/quote/quote.css","webpack:///./modules/plugins/image/image.js","webpack:///./modules/plugins/image/image.css","webpack:///./modules/plugins/instagram/instagram.js","webpack:///./modules/plugins/instagram/instagram.css","webpack:///./modules/plugins/twitter/twitter.js","webpack:///./modules/plugins/twitter/twitter.css","webpack:///./modules/plugins/paste/paste.js","webpack:///./modules/plugins/paste/paste.css","webpack:///./modules/callbacks.js","webpack:///./modules/draw.js","webpack:///./modules/caret.js","webpack:///./modules/notifications.js","webpack:///./modules/parser.js"],"names":["editor","require","module","exports","codex","init","settings","tools","textareaId","uploadImagesUrl","initialBlockPlugin","nodes","textarea","wrapper","toolbar","inlineToolbar","buttons","actions","toolbox","notifications","plusButton","showSettingsButton","showTrashButton","blockSettings","pluginSettings","defaultSettings","toolbarButtons","redactor","state","jsonOutput","blocks","inputs","start","userSettings","core","prepare","then","ui","make","addTools","bindEvents","preparePlugins","transport","renderer","makeBlocksFromData","saveInputs","catch","error","log","Promise","resolve","reject","data","document","getElementById","undefined","Error","msg","type","arg","window","console","e","insertAfter","target","element","parentNode","insertBefore","nextSibling","nodeTypes","TAG","TEXT","COMMENT","keys","BACKSPACE","TAB","ENTER","SHIFT","CTRL","ALT","ESC","SPACE","LEFT","UP","DOWN","RIGHT","DELETE","META","isDomNode","el","nodeType","ajax","url","XMLHTTP","XMLHttpRequest","ActiveXObject","success_function","params","obj","async","success","test","encodeURIComponent","withCredentials","beforeSend","call","open","setRequestHeader","onreadystatechange","readyState","status","responseText","send","importScript","scriptPath","instanceName","script","createElement","src","defer","id","head","appendChild","className","BLOCK_CLASSNAME","BLOCK_CONTENT","BLOCK_STRETCHED","BLOCK_HIGHLIGHTED","BLOCK_IN_FEED_MODE","SETTINGS_ITEM","toolbarContent","ceBlock","blockButtons","draw","alertsHolder","body","settingsButton","makeRemoveBlockButton","pluginsSettings","makeInlineToolbar","addDefaultSettings","container","inlineToolbarButtons","inlineToolbarActions","tool","tool_button","name","displayInToolbox","iconClassname","toolbarButton","addInlineToolbarTools","bold","icon","command","italic","underline","link","toolButton","toolbarButtonInline","setInlineToolbarButtonBehaviour","addEventListener","errorMsg","lineNumber","errorThrown","event","callback","globalKeydown","globalKeyup","redactorClicked","plusButtonClicked","showSettingsButtonClicked","redactorInputEvent","button","toolbarButtonClicked","addBlockHandlers","block","blockKeydown","blockPaste","inline","show","elements","querySelectorAll","addInitialBlock","initialBlockType","initialBlock","render","setAttribute","content","insertBlock","workingNodeChanged","toolClicked","input","arguments","fileSelected","clearInput","files","filesLength","length","formdData","FormData","file","i","append","selectAndUpload","args","click","xhr","onload","items","appendBlocks","nodeSequence","index","appendNodeAtIndex","getNodeAsync","createBlockFromData","blockData","blocksList","pluginName","stretched","isStretched","saver","saveBlocks","html","innerHTML","childNodes","makeQueue","queue","getBlockData","makeFormDataFromBlocks","dataset","save","blockContent","pluginsContent","savedData","output","cover","classList","contains","push","currentNode","sync","getNodeFocused","selection","getSelection","focused","anchorNode","focusNode","parentElement","parser","isFirstLevelBlock","parent","markBlock","add","clearMark","remove","getFirstLevelBlock","node","targetNode","replaceBlock","function_name","targetBlock","newBlock","replaceChild","needPlaceCaret","workingBlock","newBlockContent","blockType","composeNewBlock","currentInputIndex","caret","getCurrentInputIndex","editableElement","querySelector","emptyText","createTextNode","set","move","showPlusButton","setTimeout","setToNextBlock","switchBlock","blockToReplace","newBlockComposed","getDeepestTextNodeFromPosition","position","blockChilds","text","textContent","trim","removeChild","looking_from_start","getRange","getRangeAt","splitBlock","inputIndex","anchorNodeText","caretOffset","anchorOffset","textBeforeCaret","textNodeBeforeCaret","textAfterCaret","textNodeAfterCaret","currentBlock","substring","previousChilds","nextChilds","reachedCurrent","child","previousChildsLength","nextChildsLength","newNode","NEW_BLOCK_TYPE","mergeBlocks","targetInputIndex","targetInput","currentInputContent","paste","mutation","workingNode","allowedToPaste","sanitize","addedNodes","pasteTextContent","textNode","dfs","clearStyles","href","blockTags","allowedTags","needReplace","includes","tagName","isDisplayedAsBlock","replace","getAttribute","attributes","removeAttribute","sanitized","defaultToolbarHeight","defaultOffset","opened","current","close","toggle","hidePlusButton","toolbarHeight","clientHeight","newYCoordinate","offsetTop","style","transform","Math","floor","hideRemoveActions","setting","toolType","feedModeToggler","makeFeedModeToggler","isFeedModeActivated","updateFeedMode","removeBlockWrapper","settingButton","actionWrapper","confirmAction","cancelAction","removeButtonClicked","confirmRemovingRequest","cancelRemovingRequest","action","showRemoveActions","firstLevelBlocksCount","buttonsOpened","actionsOpened","wrappersOffset","storedSelection","selectedText","getSelectionText","showButtons","getWrappersOffset","coords","getSelectionCoords","newCoordinateX","newCoordinateY","offsetHeight","x","left","y","scrollY","top","closeButtons","closeAction","createLinkAction","defaultToolAction","forEach","hightlight","offset","getOffset","_x","_y","isNaN","offsetLeft","clientLeft","clientTop","offsetParent","sel","range","createRange","collapse","boundingLeft","boundingTop","rangeCount","cloneRange","getClientRects","rect","toString","showActions","isActive","isLinkActive","editable","saveSelection","restoreSelection","inputForLink","focus","preventDefault","keyCode","setAnchor","value","stopImmediatePropagation","clearRange","dataType","execCommand","containerEl","preSelectionRange","selectNodeContents","setEnd","startContainer","startOffset","end","savedSel","charIndex","setStart","nodeStack","foundStart","stop","nextCharIndex","pop","removeAllRanges","addRange","queryCommandState","setButtonHighlighted","removeButtonsHighLight","tag","leaf","currentTool","Object","barButtons","nextToolIndex","toolToSelect","indexOf","UNREPLACEBLE_TOOLS","appendCallback","setToBlock","paragraph","code","list","quote","image","instagram","twitter","paragraphTool","contentEditable","callbacks","pasted","enableLineBreaks","codeTool","baseClass","linkTool","defaultText","ENTER_KEY","currentInput","elementClasses","title","description","loader","makeNewBlock","mainBlock","blockPasteCallback","blockKeyDownCallback","json","linkElement","fullLink","shortLink","clipboardData","pastedData","getData","renderLink","stopPropagation","inputTag","urlify","fetch","encodeURI","response","composeLinkPreview","urlRegex","links","match","previewBlock","siteImage","siteTitle","siteDescription","siteLink","linkUrl","linkText","placeholder","imageSrc","imageClass","imageTag","linkTag","innerText","titleText","titleTag","descriptionText","descriptionTag","listTool","li","br","array","newLi","makeSettings","holder","selectTypeButton","orderedButton","unorderedButton","changeBlockStyle","newEditable","oldEditable","blockClass","buttonType","types","unordered","ordered","quoteTools","path","defaultStyle","makeBlockToAppend","makeSimpleQuote","makeQuoteWithCaption","makeQuoteWithPhoto","author","job","photo","parsedblock","parseBlockQuote","simple","withCaption","withPhoto","styles","selectedType","changeStyleClicked","changeStyleButton","ce_quote","newStyle","styleSelectors","quoteStyle","selectTypeQuoteStyle","quoteStyleFunction","addSelectTypeClickListener","parsedOldQuote","newStyledQuote","makeBlock","quoteText","blockquote","quoteAuthor","authorsJob","authorsPhoto","img","authorsPhotoWrapper","fileUploadClicked","authorsWrapper","authorHolder","getElementsByTagName","photoUploadingCallbacks","caption","$classList","attribute","result","parsed","JSON","parse","filename","uploadImageWrapper","ceImage","ce_image","loading","blockStretched","uploadedImage","centered","imageCaption","imageWrapper","formHolder","uploadButton","isStretch","makeImage","makeForm","uploadButtonClicked","selectTypeClicked","getImage","background","border","bigUrl","width","height","additionalData","source","div","imageTypeClass","centeredImage","stretchedImage","instagramTool","instagramBlock","media","conversation","user","instgrm","Embeds","process","anchor","instgrmVersion","reneder","twitterTool","profile_image_url","profile_image_url_https","screen_name","tweetId","created_at","status_url","tweet","twitterBlock","twttr","widgets","createTweet","pasteTool","clipBoardData","analize","string","regexTemplates","RegExp","facebook","vk","exec","uploadImage","instagramMedia","twitterMedia","facebookMedia","vkMedia","ajaxUrl","location","protocol","hostname","success_callback","fullUrl","arr","split","redactorSyncTimeout","tabKeyPressed","enterKeyPressed","escapeKeyPressed","defaultKeyPressed","arrowKeyPressed","firstLevelBlocksArea","clickedOnFirstLevelBlockArea","enterPressedOnBlock","saveCurrentInputIndex","isEnterPressedOnToolbar","shiftKey","isLastTextNode","currentSelection","currentSelectedNode","caretAtTheEndOfText","atTheEnd","isTextNodeHasParentBetweenContenteditable","indexOfLastInput","firstLevelBlock","inputIsEmpty","currentNodeType","flag","clearTimeout","blockRightOrDownArrowPressed","backspacePressed","blockLeftOrUpArrowPressed","focusedNode","focusedNodeHolder","editableElementIndex","caretInLastChild","lastChild","deepestTextnode","caretInFirstChild","caretAtTheBeginning","firstChild","setToPreviousBlock","selectionLength","endOffset","atStart","_blockPaste","observer","MutationObserver","handlePasteEvents","config","childList","characterData","observe","mutations","currentToolType","bar","toggler","classname","tool_icon","tool_title","properties","pluginsRender","cEditor","focusedNodeIndex","childs","nodeToSet","nextInput","emptyTextElement","assert","previousInput","lastChildNode","lengthOfLastChildNode","isFirstNode","isOffsetZero","message","notification","getSeparatedTexttSeparatedTextFromContent","insertPastedContent","getSeparatedTextFromContent","parsedTextContent","parseTextareaContent","initialContent","getNodesFromString","appendNodesToRedactor","inputString","contentHolder","createBlockByDomNode","nodeList","item","storeBlockType","parentBlock","nodeContent","isPlainTextNode"],"mappings":"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","file":"./bundle/codex.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap f6333665d8658a836b93\n **/","/**\n *\n */\n\n'use strict';\n\nvar editor = require('./editor');\n// var editor = 10;\n\nmodule.exports = {\n    editor: editor\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./index.js\n **/","var codex = (function(codex){\n\n    var init = function() {\n\n        require('./modules/core');\n        require('./modules/ui');\n        require('./modules/transport');\n        require('./modules/renderer');\n        require('./modules/saver');\n        require('./modules/content');\n        require('./modules/toolbar/toolbar');\n        require('./modules/tools');\n        require('./modules/callbacks');\n        require('./modules/draw');\n        require('./modules/caret');\n        require('./modules/notifications');\n        require('./modules/parser');\n    };\n\n    /**\n     * @public\n     *\n     * holds initial settings\n     */\n    codex.settings = {\n        tools     : ['paragraph', 'header', 'picture', 'list', 'quote', 'code', 'twitter', 'instagram', 'smile'],\n        textareaId: 'codex-editor',\n        uploadImagesUrl: '/editor/transport/',\n\n        // Type of block showing on empty editor\n        initialBlockPlugin: \"paragraph\"\n    };\n\n    /**\n     * public\n     *\n     * Static nodes\n     */\n    codex.nodes = {\n        textarea          : null,\n        wrapper           : null,\n        toolbar           : null,\n        inlineToolbar     : {\n            wrapper : null,\n            buttons : null,\n            actions : null\n        },\n        toolbox           : null,\n        notifications     : null,\n        plusButton        : null,\n        showSettingsButton: null,\n        showTrashButton   : null,\n        blockSettings     : null,\n        pluginSettings    : null,\n        defaultSettings   : null,\n        toolbarButtons    : {}, // { type : DomEl, ... }\n        redactor          : null\n    };\n\n    /**\n     * @public\n     *\n     * Output state\n     */\n    codex.state = {\n        jsonOutput: [],\n        blocks    : [],\n        inputs    : []\n    };\n\n    /**\n     * Initialization\n     * @uses Promise cEditor.core.prepare\n     * @param {} userSettings are :\n     *          - tools [],\n     *          - textareaId String\n     *          ...\n     */\n    codex.start = function (userSettings) {\n\n        init();\n\n        /**\n         * Load user defined tools\n         * Tools must contain this important objects :\n         *  @param {String} Type - this is a type of plugin. It can be used as plugin name\n         *  @param {String} iconClassname - this a icon in toolbar\n         *  @param {Object} make - what should plugin do, when it is clicked\n         *  @param {Object} appendCallback - callback after clicking\n         *  @param {Element} settings - what settings does it have\n         *  @param {Object} render - plugin get JSON, and should return HTML\n         *  @param {Object} save - plugin gets HTML content, returns JSON\n         *  @param {Boolean} displayInToolbox - will be displayed in toolbox. Default value is TRUE\n         *  @param {Boolean} enableLineBreaks - inserts new block or break lines. Default value is FALSE\n         *\n         * @example\n         *   -  type             : 'header',\n         *   -  iconClassname    : 'ce-icon-header',\n         *   -  make             : headerTool.make,\n         *   -  appendCallback   : headerTool.appendCallback,\n         *   -  settings         : headerTool.makeSettings(),\n         *   -  render           : headerTool.render,\n         *   -  save             : headerTool.save,\n         *   -  displayInToolbox : true,\n         *   -  enableLineBreaks : false\n         *\n         */\n        this.core.prepare(userSettings)\n\n        // If all ok, make UI, bind events and parse initial-content\n            .then(this.ui.make)\n            .then(this.ui.addTools)\n            .then(this.ui.bindEvents)\n            .then(this.ui.preparePlugins)\n            .then(this.transport.prepare)\n            .then(this.renderer.makeBlocksFromData)\n            .then(this.ui.saveInputs)\n            .catch(function (error) {\n                codex.core.log('Initialization failed with error: %o', 'warn', error);\n            });\n\n    };\n\n    return codex;\n\n})({});\n\nmodule.exports = codex;\n\n\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./editor.js\n **/","var codex = require('./../editor');\n\nvar core = (function(core) {\n\n    /**\n     * @public\n     *\n     * Editor preparing method\n     * @return Promise\n     */\n    core.prepare = function (userSettings) {\n\n        return new Promise(function(resolve, reject) {\n\n            if ( userSettings ){\n\n                codex.settings.tools = userSettings.tools || codex.settings.tools;\n\n            }\n\n            if (userSettings.data) {\n                codex.state.blocks = userSettings.data;\n            }\n\n            codex.nodes.textarea = document.getElementById(userSettings.textareaId || codex.settings.textareaId);\n\n            if (typeof codex.nodes.textarea === undefined || codex.nodes.textarea === null) {\n                reject(Error(\"Textarea wasn't found by ID: #\" + userSettings.textareaId));\n            } else {\n                resolve();\n            }\n\n        });\n\n    };\n\n    /**\n     * Logging method\n     * @param type = ['log', 'info', 'warn']\n     */\n    core.log = function (msg, type, arg) {\n\n        type = type || 'log';\n\n        if (!arg) {\n            arg  = msg || 'undefined';\n            msg  = '[codex-editor]:      %o';\n        } else {\n            msg  = '[codex-editor]:      ' + msg;\n        }\n\n        try{\n            if ( 'console' in window && console[ type ] ){\n                if ( arg ) console[ type ]( msg , arg );\n                else console[ type ]( msg );\n            }\n\n        }catch(e){}\n\n    };\n\n    /**\n     * @protected\n     *\n     * Helper for insert one element after another\n     */\n    core.insertAfter = function (target, element) {\n        target.parentNode.insertBefore(element, target.nextSibling);\n    };\n\n    /**\n     * @const\n     *\n     * Readable DOM-node types map\n     */\n    core.nodeTypes = {\n        TAG     : 1,\n        TEXT    : 3,\n        COMMENT : 8\n    };\n\n    /**\n     * @const\n     * Readable keys map\n     */\n    core.keys = { BACKSPACE: 8, TAB: 9, ENTER: 13, SHIFT: 16, CTRL: 17, ALT: 18, ESC: 27, SPACE: 32, LEFT: 37, UP: 38, DOWN: 40, RIGHT: 39, DELETE: 46, META: 91 };\n\n    /**\n     * @protected\n     *\n     * Check object for DOM node\n     */\n    core.isDomNode = function (el) {\n        return el && typeof el === 'object' && el.nodeType && el.nodeType == this.nodeTypes.TAG;\n    };\n\n    /**\n     * Native Ajax\n     */\n    core.ajax = function (data) {\n\n        if (!data || !data.url){\n            return;\n        }\n\n        var XMLHTTP          = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject(\"Microsoft.XMLHTTP\"),\n            success_function = function(){},\n            params = '',\n            obj;\n\n        data.async           = true;\n        data.type            = data.type || 'GET';\n        data.data            = data.data || '';\n        data['content-type'] = data['content-type'] || 'application/json; charset=utf-8';\n        success_function     = data.success || success_function ;\n\n        if (data.type == 'GET' && data.data) {\n\n            data.url = /\\?/.test(data.url) ? data.url + '&' + data.data : data.url + '?' + data.data;\n\n        } else {\n\n            for(obj in data.data) {\n                params += (obj + '=' + encodeURIComponent(data.data[obj]) + '&');\n            }\n        }\n\n        if (data.withCredentials) {\n            XMLHTTP.withCredentials = true;\n        }\n\n        if (data.beforeSend && typeof data.beforeSend == 'function') {\n            data.beforeSend.call();\n        }\n\n        XMLHTTP.open( data.type, data.url, data.async );\n        XMLHTTP.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n        XMLHTTP.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n\n        XMLHTTP.onreadystatechange = function() {\n            if (XMLHTTP.readyState == 4 && XMLHTTP.status == 200) {\n                success_function(XMLHTTP.responseText);\n            }\n        };\n\n        XMLHTTP.send(params);\n    };\n\n    /** Appends script to head of document */\n    core.importScript = function(scriptPath, instanceName) {\n\n        /** Script is already loaded */\n        if ( !instanceName || (instanceName && document.getElementById('ce-script-' + instanceName)) ) {\n            codex.core.log(\"Instance name of script is missed or script is already loaded\", \"warn\");\n            return;\n        }\n\n\n        var script   = document.createElement('SCRIPT');\n        script.type = \"text/javascript\";\n        script.src = scriptPath;\n        script.async = true;\n        script.defer = true;\n\n        if (instanceName) {\n            script.id = \"ce-script-\" + instanceName;\n        }\n\n        document.head.appendChild(script);\n        return script;\n    };\n\n    return core;\n\n})({});\n\ncodex.core = core;\n\nmodule.exports = core;\n\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./modules/core.js\n **/","var codex = require('../editor');\n\nvar ui = (function(ui){\n\n    /**\n     * Basic editor classnames\n     */\n    ui.className = {\n\n        /**\n         * @const {string} BLOCK_CLASSNAME - redactor blocks name\n         */\n        BLOCK_CLASSNAME : 'ce-block',\n\n            /**\n             * @const {String} wrapper for plugins content\n             */\n            BLOCK_CONTENT : 'ce-block__content',\n\n            /**\n             * @const {String} BLOCK_STRETCHED - makes block stretched\n             */\n            BLOCK_STRETCHED : 'ce-block--stretched',\n\n            /**\n             * @const {String} BLOCK_HIGHLIGHTED - adds background\n             */\n            BLOCK_HIGHLIGHTED : 'ce-block--focused',\n\n            /**\n             * @const {String} - highlights covered blocks\n             */\n            BLOCK_IN_FEED_MODE : 'ce-block--feed-mode',\n\n            /**\n             * @const {String} - for all default settings\n             */\n            SETTINGS_ITEM : 'ce-settings__item'\n\n    };\n\n    /**\n     * @protected\n     *\n     * Making main interface\n     */\n    ui.make = function () {\n\n        var wrapper,\n            toolbar,\n            toolbarContent,\n            inlineToolbar,\n            redactor,\n            ceBlock,\n            notifications,\n            blockButtons,\n            blockSettings,\n            showSettingsButton,\n            showTrashButton,\n            toolbox,\n            plusButton;\n\n        /** Make editor wrapper */\n        wrapper = codex.draw.wrapper();\n\n        /** Append editor wrapper after initial textarea */\n        codex.core.insertAfter(codex.nodes.textarea, wrapper);\n\n        /** Append block with notifications to the document */\n        notifications = codex.draw.alertsHolder();\n        codex.nodes.notifications = document.body.appendChild(notifications);\n\n        /** Make toolbar and content-editable redactor */\n        toolbar               = codex.draw.toolbar();\n        toolbarContent        = codex.draw.toolbarContent();\n        inlineToolbar         = codex.draw.inlineToolbar();\n        plusButton            = codex.draw.plusButton();\n        showSettingsButton    = codex.draw.settingsButton();\n        showTrashButton       = codex.toolbar.settings.makeRemoveBlockButton();\n        blockSettings         = codex.draw.blockSettings();\n        blockButtons          = codex.draw.blockButtons();\n        toolbox               = codex.draw.toolbox();\n        redactor              = codex.draw.redactor();\n\n        /** settings */\n        var defaultSettings = codex.draw.defaultSettings(),\n            pluginSettings  = codex.draw.pluginsSettings();\n\n        /** Add default and plugins settings */\n        blockSettings.appendChild(pluginSettings);\n        blockSettings.appendChild(defaultSettings);\n\n        /** Make blocks buttons\n         * This block contains settings button and remove block button\n         */\n        blockButtons.appendChild(showSettingsButton);\n        blockButtons.appendChild(showTrashButton);\n        blockButtons.appendChild(blockSettings);\n\n        /** Append plus button */\n        toolbarContent.appendChild(plusButton);\n\n        /** Appending toolbar tools */\n        toolbarContent.appendChild(toolbox);\n\n        /** Appending first-level block buttons */\n        toolbar.appendChild(blockButtons);\n\n        /** Append toolbarContent to toolbar */\n        toolbar.appendChild(toolbarContent);\n\n        wrapper.appendChild(toolbar);\n\n        wrapper.appendChild(redactor);\n\n        /** Save created ui-elements to static nodes state */\n        codex.nodes.wrapper            = wrapper;\n        codex.nodes.toolbar            = toolbar;\n        codex.nodes.plusButton         = plusButton;\n        codex.nodes.toolbox            = toolbox;\n        codex.nodes.blockSettings      = blockSettings;\n        codex.nodes.pluginSettings     = pluginSettings;\n        codex.nodes.defaultSettings    = defaultSettings;\n        codex.nodes.showSettingsButton = showSettingsButton;\n        codex.nodes.showTrashButton    = showTrashButton;\n\n        codex.nodes.redactor = redactor;\n\n        codex.ui.makeInlineToolbar(inlineToolbar);\n\n        /** fill in default settings */\n        codex.toolbar.settings.addDefaultSettings();\n    };\n\n    ui.makeInlineToolbar = function(container) {\n\n        /** Append to redactor new inline block */\n        codex.nodes.inlineToolbar.wrapper = container;\n\n        /** Draw toolbar buttons */\n        codex.nodes.inlineToolbar.buttons = codex.draw.inlineToolbarButtons();\n\n        /** Buttons action or settings */\n        codex.nodes.inlineToolbar.actions = codex.draw.inlineToolbarActions();\n\n        /** Append to inline toolbar buttons as part of it */\n        codex.nodes.inlineToolbar.wrapper.appendChild(codex.nodes.inlineToolbar.buttons);\n        codex.nodes.inlineToolbar.wrapper.appendChild(codex.nodes.inlineToolbar.actions);\n\n        codex.nodes.wrapper.appendChild(codex.nodes.inlineToolbar.wrapper);\n    };\n\n    /**\n     * @private\n     * Append tools passed in codex.tools\n     */\n    ui.addTools = function () {\n\n        var tool,\n            tool_button;\n\n        for(var name in codex.settings.tools) {\n            tool = codex.settings.tools[name];\n            codex.tools[name] = tool;;\n        }\n\n        /** Make toolbar buttons */\n        for (var name in codex.tools){\n\n            tool = codex.tools[name];\n\n            if (tool.displayInToolbox == false) {\n                continue;\n            }\n\n            if (!tool.iconClassname) {\n                codex.core.log('Toolbar icon classname missed. Tool %o skipped', 'warn', name);\n                continue;\n            }\n\n            if (typeof tool.make != 'function') {\n                codex.core.log('make method missed. Tool %o skipped', 'warn', name);\n                continue;\n            }\n\n            /**\n             * if tools is for toolbox\n             */\n            tool_button = codex.draw.toolbarButton(name, tool.iconClassname);\n\n            codex.nodes.toolbox.appendChild(tool_button);\n\n            /** Save tools to static nodes */\n            codex.nodes.toolbarButtons[name] = tool_button;\n        }\n\n\n        /**\n         * Add inline toolbar tools\n         */\n        codex.ui.addInlineToolbarTools();\n\n\n    };\n\n    ui.addInlineToolbarTools = function() {\n\n        var tools = {\n\n            bold: {\n                icon    : 'ce-icon-bold',\n                command : 'bold'\n            },\n\n            italic: {\n                icon    : 'ce-icon-italic',\n                command : 'italic'\n            },\n\n            underline: {\n                icon    : 'ce-icon-underline',\n                command : 'underline'\n            },\n\n            link: {\n                icon    : 'ce-icon-link',\n                command : 'createLink',\n            }\n        };\n\n        var toolButton,\n            tool;\n\n        for(var name in tools) {\n\n            tool = tools[name];\n\n            toolButton = codex.draw.toolbarButtonInline(name, tool.icon);\n\n            codex.nodes.inlineToolbar.buttons.appendChild(toolButton);\n            /**\n             * Add callbacks to this buttons\n             */\n            codex.ui.setInlineToolbarButtonBehaviour(toolButton, tool.command);\n        }\n\n    };\n\n    /**\n     * @private\n     * Bind editor UI events\n     */\n    ui.bindEvents = function () {\n\n        codex.core.log('ui.bindEvents fired', 'info');\n\n        window.addEventListener('error', function (errorMsg, url, lineNumber) {\n            codex.notifications.errorThrown(errorMsg, event);\n        }, false );\n\n        /** All keydowns on Document */\n        codex.nodes.redactor.addEventListener('keydown', codex.callback.globalKeydown, false );\n\n        /** All keydowns on Document */\n        document.addEventListener('keyup', codex.callback.globalKeyup, false );\n\n        /**\n         * Mouse click to radactor\n         */\n        codex.nodes.redactor.addEventListener('click', codex.callback.redactorClicked, false );\n\n        /**\n         * Clicks to the Plus button\n         */\n        codex.nodes.plusButton.addEventListener('click', codex.callback.plusButtonClicked, false);\n\n        /**\n         * Clicks to SETTINGS button in toolbar\n         */\n        codex.nodes.showSettingsButton.addEventListener('click', codex.callback.showSettingsButtonClicked, false );\n        /**\n         *  @deprecated ( but now in use for syncronization );\n         *  Any redactor changes: keyboard input, mouse cut/paste, drag-n-drop text\n         */\n        codex.nodes.redactor.addEventListener('input', codex.callback.redactorInputEvent, false );\n\n        /** Bind click listeners on toolbar buttons */\n        for (var button in codex.nodes.toolbarButtons){\n            codex.nodes.toolbarButtons[button].addEventListener('click', codex.callback.toolbarButtonClicked, false);\n        }\n\n    };\n\n    /**\n     * Initialize plugins before using\n     * Ex. Load scripts or call some internal methods\n     */\n    ui.preparePlugins = function() {\n\n        for(var tool in codex.tools) {\n\n            if (typeof codex.tools[tool].prepare != 'function')\n                continue;\n\n            codex.tools[tool].prepare();\n        }\n    },\n\n    ui.addBlockHandlers = function(block) {\n\n        if (!block) return;\n\n        /**\n         * Block keydowns\n         */\n        block.addEventListener('keydown', function(event) {\n            codex.callback.blockKeydown(event, block);\n        }, false);\n\n        /**\n         * Pasting content from another source\n         */\n        block.addEventListener('paste', function (event) {\n            codex.callback.blockPaste(event);\n        }, false);\n\n        block.addEventListener('mouseup', function(){\n            codex.toolbar.inline.show();\n        }, false);\n\n    };\n\n    /** getting all contenteditable elements */\n    ui.saveInputs = function() {\n\n        var redactor = codex.nodes.redactor,\n            elements = [];\n\n        /** Save all inputs in global variable state */\n        codex.state.inputs = redactor.querySelectorAll('[contenteditable], input');\n    };\n\n    /**\n     * Adds first initial block on empty redactor\n     */\n    ui.addInitialBlock = function(){\n\n        var initialBlockType = codex.settings.initialBlockPlugin,\n            initialBlock;\n\n        if ( !codex.tools[initialBlockType] ){\n            codex.core.log('Plugin %o was not implemented and can\\'t be used as initial block', 'warn', initialBlockType);\n            return;\n        }\n\n        initialBlock = codex.tools[initialBlockType].render();\n\n        initialBlock.setAttribute('data-placeholder', 'Write your story...');\n\n        codex.content.insertBlock({\n            type  : initialBlockType,\n            block : initialBlock\n        });\n\n        codex.content.workingNodeChanged(initialBlock);\n\n    };\n\n    ui.setInlineToolbarButtonBehaviour = function(button, type) {\n\n        button.addEventListener('mousedown', function(event) {\n\n            codex.toolbar.inline.toolClicked(event, type);\n\n        }, false);\n    };\n\n    return ui;\n\n})({});\n\ncodex.ui = ui;\nmodule.exports = codex;\n\n\n/** WEBPACK FOOTER **\n ** ./modules/ui.js\n **/","var codex = require('../editor');\n\nvar transport = (function(transport){\n\n    transport.input = null;\n\n    /**\n     * @property {Object} arguments - keep plugin settings and defined callbacks\n     */\n    transport.arguments = null;\n\n    transport.prepare = function(){\n\n        var input = document.createElement('INPUT');\n\n        input.type = 'file';\n        input.addEventListener('change', codex.transport.fileSelected);\n\n        codex.transport.input = input;\n\n    };\n\n    /** Clear input when files is uploaded */\n    transport.clearInput = function() {\n\n        /** Remove old input */\n        this.input = null;\n\n        /** Prepare new one */\n        this.prepare();\n    };\n\n    /**\n     * Callback for file selection\n     */\n    transport.fileSelected = function(event){\n\n        var input       = this,\n            files       = input.files,\n            filesLength = files.length,\n            formdData   = new FormData(),\n            file,\n            i;\n\n        formdData.append('files', files[0], files[0].name);\n\n        codex.transport.ajax({\n            data : formdData,\n            beforeSend : codex.transport.arguments.beforeSend,\n            success    : codex.transport.arguments.success,\n            error      : codex.transport.arguments.error\n        });\n    };\n\n    /**\n     * Use plugin callbacks\n     * @protected\n     */\n    transport.selectAndUpload = function (args) {\n\n        this.arguments = args;\n        this.input.click();\n\n    };\n\n    /**\n     * Ajax requests module\n     */\n    transport.ajax = function(params){\n\n        var xhr = new XMLHttpRequest(),\n            beforeSend = typeof params.beforeSend == 'function' ? params.beforeSend : function(){},\n            success    = typeof params.success    == 'function' ? params.success : function(){},\n            error      = typeof params.error      == 'function' ? params.error   : function(){};\n\n        beforeSend();\n\n        xhr.open('POST', codex.settings.uploadImagesUrl, true);\n\n        xhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n\n        xhr.onload = function () {\n            if (xhr.status === 200) {\n                success(xhr.responseText);\n            } else {\n                console.log(\"request error: %o\", xhr);\n                error();\n            }\n        };\n\n        xhr.send(params.data);\n        this.clearInput();\n\n    };\n\n    return transport;\n\n})({});\n\ncodex.transport = transport;\nmodule.exports  = transport;\n\n\n/** WEBPACK FOOTER **\n ** ./modules/transport.js\n **/","var codex = require('../editor');\n\nvar renderer = (function(renderer) {\n\n    /**\n     * Asyncronously parses input JSON to redactor blocks\n     */\n    renderer.makeBlocksFromData = function () {\n\n        /**\n         * If redactor is empty, add first paragraph to start writing\n         */\n        if (!codex.state.blocks.items.length) {\n\n            codex.ui.addInitialBlock();\n            return;\n\n        }\n\n        Promise.resolve()\n\n        /** First, get JSON from state */\n            .then(function() {\n                return codex.state.blocks;\n            })\n\n            /** Then, start to iterate they */\n            .then(codex.renderer.appendBlocks)\n\n            /** Write log if something goes wrong */\n            .catch(function(error) {\n                codex.core.log('Error while parsing JSON: %o', 'error', error);\n            });\n\n    };\n\n    /**\n     * Parses JSON to blocks\n     * @param {object} data\n     * @return Primise -> nodeList\n     */\n    renderer.appendBlocks = function (data) {\n\n        var blocks = data.items;\n\n        /**\n         * Sequence of one-by-one blocks appending\n         * Uses to save blocks order after async-handler\n         */\n        var nodeSequence = Promise.resolve();\n\n        for (var index = 0; index < blocks.length ; index++ ) {\n\n            /** Add node to sequence at specified index */\n            codex.renderer.appendNodeAtIndex(nodeSequence, blocks, index);\n\n        }\n\n    };\n\n    /**\n     * Append node at specified index\n     */\n    renderer.appendNodeAtIndex = function (nodeSequence, blocks, index) {\n\n        /** We need to append node to sequence */\n        nodeSequence\n\n        /** first, get node async-aware */\n            .then(function() {\n\n                return codex.renderer.getNodeAsync(blocks , index);\n\n            })\n\n            /**\n             * second, compose editor-block from JSON object\n             */\n            .then(codex.renderer.createBlockFromData)\n\n            /**\n             * now insert block to redactor\n             */\n            .then(function(blockData){\n\n                /**\n                 * blockData has 'block', 'type' and 'stretched' information\n                 */\n                codex.content.insertBlock(blockData);\n\n                /** Pass created block to next step */\n                return blockData.block;\n\n            })\n\n            /** Log if something wrong with node */\n            .catch(function(error) {\n                codex.core.log('Node skipped while parsing because %o', 'error', error);\n            });\n\n    };\n\n    /**\n     * Asynchronously returns block data from blocksList by index\n     * @return Promise to node\n     */\n    renderer.getNodeAsync = function (blocksList, index) {\n\n        return Promise.resolve().then(function() {\n\n            return blocksList[index];\n\n        });\n    };\n\n    /**\n     * Creates editor block by JSON-data\n     *\n     * @uses render method of each plugin\n     *\n     * @param {object} blockData looks like\n     *                            { header : {\n     *                                            text: '',\n     *                                            type: 'H3', ...\n     *                                        }\n     *                            }\n     * @return {object} with type and Element\n     */\n    renderer.createBlockFromData = function (blockData) {\n\n        /** New parser */\n        var pluginName = blockData.type;\n\n        /** Get first key of object that stores plugin name */\n        // for (var pluginName in blockData) break;\n\n        /** Check for plugin existance */\n        if (!codex.tools[pluginName]) {\n            throw Error(`Plugin «${pluginName}» not found`);\n        }\n\n        /** Check for plugin having render method */\n        if (typeof codex.tools[pluginName].render != 'function') {\n\n            throw Error(`Plugin «${pluginName}» must have «render» method`);\n        }\n\n        /** New Parser */\n        var block = codex.tools[pluginName].render(blockData.data);\n\n        /** Fire the render method with data */\n        // var block = codex.tools[pluginName].render(blockData[pluginName]);\n\n        /** is first-level block stretched */\n        var stretched = codex.tools[pluginName].isStretched || false;\n\n        /** Retrun type and block */\n        return {\n            type      : pluginName,\n            block     : block,\n            stretched : stretched\n        };\n\n    };\n\n    return renderer;\n\n})({});\n\ncodex.renderer = renderer;\nmodule.exports = renderer;\n\n\n/** WEBPACK FOOTER **\n ** ./modules/renderer.js\n **/","var codex = require('../editor');\n\nvar saver = (function(saver) {\n\n    /**\n     * Saves blocks\n     * @private\n     */\n    saver.saveBlocks = function () {\n\n        /** Save html content of redactor to memory */\n        codex.state.html = codex.nodes.redactor.innerHTML;\n\n        /** Empty jsonOutput state */\n        codex.state.jsonOutput = [];\n\n        Promise.resolve()\n\n            .then(function() {\n                return codex.nodes.redactor.childNodes;\n            })\n            /** Making a sequence from separate blocks */\n            .then(codex.saver.makeQueue)\n\n            .then(function() {\n                // codex.nodes.textarea.innerHTML = codex.state.html;\n            })\n\n            .catch( function(error) {\n                console.log('Something happend');\n            });\n\n    };\n\n    saver.makeQueue = function(blocks) {\n\n        var queue = Promise.resolve();\n\n        for(var index = 0; index < blocks.length; index++) {\n\n            /** Add node to sequence at specified index */\n            codex.saver.getBlockData(queue, blocks, index);\n\n        }\n\n    };\n\n    /** Gets every block and makes From Data */\n    saver.getBlockData = function(queue, blocks, index) {\n\n        queue.then(function() {\n            return codex.saver.getNodeAsync(blocks, index);\n        })\n\n            .then(codex.saver.makeFormDataFromBlocks);\n\n    };\n\n\n    /**\n     * Asynchronously returns block data from blocksList by index\n     * @return Promise to node\n     */\n    saver.getNodeAsync = function (blocksList, index) {\n\n        return Promise.resolve().then(function() {\n\n            return blocksList[index];\n\n        });\n    };\n\n    saver.makeFormDataFromBlocks = function(block) {\n\n        var pluginName = block.dataset.tool;\n\n        /** Check for plugin existance */\n        if (!codex.tools[pluginName]) {\n            throw Error(`Plugin «${pluginName}» not found`);\n        }\n\n        /** Check for plugin having render method */\n        if (typeof codex.tools[pluginName].save != 'function') {\n\n            throw Error(`Plugin «${pluginName}» must have save method`);\n        }\n\n        /** Result saver */\n        var blockContent   = block.childNodes[0],\n            pluginsContent = blockContent.childNodes[0],\n            savedData      = codex.tools[pluginName].save(pluginsContent),\n            output;\n\n\n        output = {\n            type: pluginName,\n            data: savedData\n        };\n\n        /** Marks Blocks that will be in main page */\n        output.cover = block.classList.contains(codex.ui.className.BLOCK_IN_FEED_MODE);\n\n        codex.state.jsonOutput.push(output);\n    };\n\n    return saver;\n\n})({});\n\ncodex.saver = saver;\nmodule.exports = saver;\n\n\n/** WEBPACK FOOTER **\n ** ./modules/saver.js\n **/","var codex = require('../editor');\n\nvar content = (function(content) {\n\n    content.currentNode = null;\n\n    /**\n     * Synchronizes redactor with original textarea\n     */\n    content.sync = function () {\n\n        codex.core.log('syncing...');\n\n        /**\n         * Save redactor content to codex.state\n         */\n        codex.state.html = codex.nodes.redactor.innerHTML;\n\n    };\n\n    /**\n     * @deprecated\n     */\n    content.getNodeFocused = function() {\n\n        var selection = window.getSelection(),\n            focused;\n\n        if (selection.anchorNode === null) {\n            return null;\n        }\n\n        if ( selection.anchorNode.nodeType == codex.core.nodeTypes.TAG ) {\n            focused = selection.anchorNode;\n        } else {\n            focused = selection.focusNode.parentElement;\n        }\n\n        if ( !codex.parser.isFirstLevelBlock(focused) ) {\n\n            /** Iterate with parent nodes to find first-level*/\n            var parent = focused.parentNode;\n\n            while (parent && !codex.parser.isFirstLevelBlock(parent)){\n                parent = parent.parentNode;\n            }\n\n            focused = parent;\n        }\n\n        if (focused != codex.nodes.redactor){\n            return focused;\n        }\n\n        return null;\n\n    };\n\n    /**\n     * Appends background to the block\n     */\n    content.markBlock = function() {\n\n        codex.content.currentNode.classList.add(codex.ui.className.BLOCK_HIGHLIGHTED);\n    };\n\n    /**\n     * Clear background\n     */\n    content.clearMark = function() {\n\n        if (codex.content.currentNode) {\n            codex.content.currentNode.classList.remove(codex.ui.className.BLOCK_HIGHLIGHTED);\n        }\n\n    };\n\n    /**\n     * @private\n     *\n     * Finds first-level block\n     * @param {Element} node - selected or clicked in redactors area node\n     */\n    content.getFirstLevelBlock = function(node) {\n\n        if (!codex.core.isDomNode(node)) {\n            node = node.parentNode;\n        }\n\n        if (node === codex.nodes.redactor || node === document.body) {\n\n            return null;\n\n        } else {\n\n            while(!node.classList.contains(codex.ui.className.BLOCK_CLASSNAME)) {\n                node = node.parentNode;\n            }\n\n            return node;\n        }\n\n    };\n\n    /**\n     * Trigger this event when working node changed\n     * @param {Element} targetNode - first-level of this node will be current\n     * If targetNode is first-level then we set it as current else we look for parents to find first-level\n     */\n    content.workingNodeChanged = function (targetNode) {\n\n        /** Clear background from previous marked block before we change */\n        codex.content.clearMark();\n\n        if (!targetNode) {\n            return;\n        }\n\n        this.currentNode = this.getFirstLevelBlock(targetNode);\n\n    };\n\n    /**\n     * Replaces one redactor block with another\n     * @protected\n     * @param {Element} targetBlock - block to replace. Mostly currentNode.\n     * @param {Element} newBlock\n     * @param {string} newBlockType - type of new block; we need to store it to data-attribute\n     *\n     * [!] Function does not saves old block content.\n     *     You can get it manually and pass with newBlock.innerHTML\n     */\n    content.replaceBlock = function function_name(targetBlock, newBlock) {\n\n        if (!targetBlock || !newBlock){\n            codex.core.log('replaceBlock: missed params');\n            return;\n        }\n\n        /** If target-block is not a frist-level block, then we iterate parents to find it */\n        while(!targetBlock.classList.contains(codex.ui.className.BLOCK_CLASSNAME)) {\n            targetBlock = targetBlock.parentNode;\n        }\n\n        /** Replacing */\n        codex.nodes.redactor.replaceChild(newBlock, targetBlock);\n\n        /**\n         * Set new node as current\n         */\n        codex.content.workingNodeChanged(newBlock);\n\n        /**\n         * Add block handlers\n         */\n        codex.ui.addBlockHandlers(newBlock);\n\n        /**\n         * Save changes\n         */\n        codex.ui.saveInputs();\n\n    };\n\n    /**\n     * @private\n     *\n     * Inserts new block to redactor\n     * Wrapps block into a DIV with BLOCK_CLASSNAME class\n     *\n     * @param blockData          {object}\n     * @param blockData.block    {Element}   element with block content\n     * @param blockData.type     {string}    block plugin\n     * @param needPlaceCaret     {bool}      pass true to set caret in new block\n     *\n     */\n    content.insertBlock = function( blockData, needPlaceCaret ) {\n\n        var workingBlock    = codex.content.currentNode,\n            newBlockContent = blockData.block,\n            blockType       = blockData.type,\n            isStretched     = blockData.stretched;\n\n        var newBlock = codex.content.composeNewBlock(newBlockContent, blockType, isStretched);\n\n        if (workingBlock) {\n\n            codex.core.insertAfter(workingBlock, newBlock);\n\n        } else {\n            /**\n             * If redactor is empty, append as first child\n             */\n            codex.nodes.redactor.appendChild(newBlock);\n\n        }\n\n        /**\n         * Block handler\n         */\n        codex.ui.addBlockHandlers(newBlock);\n\n        /**\n         * Set new node as current\n         */\n        codex.content.workingNodeChanged(newBlock);\n\n        /**\n         * Save changes\n         */\n        codex.ui.saveInputs();\n\n\n        if ( needPlaceCaret ) {\n\n            /**\n             * If we don't know input index then we set default value -1\n             */\n            var currentInputIndex = codex.caret.getCurrentInputIndex() || -1;\n\n\n            if (currentInputIndex == -1) {\n\n\n                var editableElement = newBlock.querySelector('[contenteditable]'),\n                    emptyText       = document.createTextNode('');\n\n                editableElement.appendChild(emptyText);\n                codex.caret.set(editableElement, 0, 0);\n\n                codex.toolbar.move();\n                codex.toolbar.showPlusButton();\n\n\n            } else {\n\n                /** Timeout for browsers execution */\n                setTimeout(function () {\n\n                    /** Setting to the new input */\n                    codex.caret.setToNextBlock(currentInputIndex);\n                    codex.toolbar.move();\n                    codex.toolbar.open();\n\n                }, 10);\n\n            }\n\n        }\n\n    };\n\n    /**\n     * Replaces blocks with saving content\n     * @protected\n     * @param {Element} noteToReplace\n     * @param {Element} newNode\n     * @param {Element} blockType\n     */\n    content.switchBlock = function(blockToReplace, newBlock, tool){\n\n        var newBlockComposed = codex.content.composeNewBlock(newBlock, tool);\n\n        /** Replacing */\n        codex.content.replaceBlock(blockToReplace, newBlockComposed);\n\n        /** Save new Inputs when block is changed */\n        codex.ui.saveInputs();\n    };\n\n    /**\n     * Iterates between child noted and looking for #text node on deepest level\n     * @private\n     * @param {Element} block - node where find\n     * @param {int} postiton - starting postion\n     *      Example: childNodex.length to find from the end\n     *               or 0 to find from the start\n     * @return {Text} block\n     * @uses DFS\n     */\n    content.getDeepestTextNodeFromPosition = function (block, position) {\n\n        /**\n         * Clear Block from empty and useless spaces with trim.\n         * Such nodes we should remove\n         */\n        var blockChilds = block.childNodes,\n            index,\n            node,\n            text;\n\n        for(index = 0; index < blockChilds.length; index++)\n        {\n            node = blockChilds[index];\n\n            if (node.nodeType == codex.core.nodeTypes.TEXT) {\n\n                text = node.textContent.trim();\n\n                /** Text is empty. We should remove this child from node before we start DFS\n                 * decrease the quantity of childs.\n                 */\n                if (text === '') {\n\n                    block.removeChild(node);\n                    position--;\n                }\n            }\n        }\n\n        if (block.childNodes.length === 0) {\n            return document.createTextNode('');\n        }\n\n        /** Setting default position when we deleted all empty nodes */\n        if ( position < 0 )\n            position = 1;\n\n        var looking_from_start = false;\n\n        /** For looking from START */\n        if (position === 0) {\n            looking_from_start = true;\n            position = 1;\n        }\n\n        while ( position ) {\n\n            /** initial verticle of node. */\n            if ( looking_from_start ) {\n                block = block.childNodes[0];\n            } else {\n                block = block.childNodes[position - 1];\n            }\n\n            if ( block.nodeType == codex.core.nodeTypes.TAG ){\n\n                position = block.childNodes.length;\n\n            } else if (block.nodeType == codex.core.nodeTypes.TEXT ){\n\n                position = 0;\n            }\n\n        }\n\n        return block;\n    };\n\n    /**\n     * @private\n     */\n    content.composeNewBlock = function (block, tool, isStretched) {\n\n        var newBlock     = codex.draw.node('DIV', codex.ui.className.BLOCK_CLASSNAME, {}),\n            blockContent = codex.draw.node('DIV', codex.ui.className.BLOCK_CONTENT, {});\n\n        blockContent.appendChild(block);\n        newBlock.appendChild(blockContent);\n\n        if (isStretched) {\n            blockContent.classList.add(codex.ui.className.BLOCK_STRETCHED);\n        }\n\n        newBlock.dataset.tool = tool;\n        return newBlock;\n    };\n\n    /**\n     * Returns Range object of current selection\n     */\n    content.getRange = function() {\n\n        var selection = window.getSelection().getRangeAt(0);\n\n        return selection;\n    };\n\n    /**\n     * Divides block in two blocks (after and before caret)\n     * @private\n     * @param {Int} inputIndex - target input index\n     */\n    content.splitBlock = function(inputIndex) {\n\n        var selection      = window.getSelection(),\n            anchorNode     = selection.anchorNode,\n            anchorNodeText = anchorNode.textContent,\n            caretOffset    = selection.anchorOffset,\n            textBeforeCaret,\n            textNodeBeforeCaret,\n            textAfterCaret,\n            textNodeAfterCaret;\n\n        var currentBlock = codex.content.currentNode.querySelector('[contentEditable]');\n\n\n        textBeforeCaret     = anchorNodeText.substring(0, caretOffset);\n        textAfterCaret      = anchorNodeText.substring(caretOffset);\n\n        textNodeBeforeCaret = document.createTextNode(textBeforeCaret);\n\n        if (textAfterCaret) {\n            textNodeAfterCaret  = document.createTextNode(textAfterCaret);\n        }\n\n        var previousChilds = [],\n            nextChilds     = [],\n            reachedCurrent = false;\n\n        if (textNodeAfterCaret) {\n            nextChilds.push(textNodeAfterCaret);\n        }\n\n        for ( var i = 0, child; !!(child = currentBlock.childNodes[i]); i++) {\n\n            if ( child != anchorNode ) {\n                if ( !reachedCurrent ){\n                    previousChilds.push(child);\n                } else {\n                    nextChilds.push(child);\n                }\n            } else {\n                reachedCurrent = true;\n            }\n\n        }\n\n        /** Clear current input */\n        codex.state.inputs[inputIndex].innerHTML = '';\n\n        /**\n         * Append all childs founded before anchorNode\n         */\n        var previousChildsLength = previousChilds.length;\n\n        for(i = 0; i < previousChildsLength; i++) {\n            codex.state.inputs[inputIndex].appendChild(previousChilds[i]);\n        }\n\n        codex.state.inputs[inputIndex].appendChild(textNodeBeforeCaret);\n\n        /**\n         * Append text node which is after caret\n         */\n        var nextChildsLength = nextChilds.length,\n            newNode          = document.createElement('div');\n\n        for(i = 0; i < nextChildsLength; i++) {\n            newNode.appendChild(nextChilds[i]);\n        }\n\n        newNode = newNode.innerHTML;\n\n        /** This type of block creates when enter is pressed */\n        var NEW_BLOCK_TYPE = 'paragraph';\n\n        /**\n         * Make new paragraph with text after caret\n         */\n        codex.content.insertBlock({\n            type  : NEW_BLOCK_TYPE,\n            block : codex.tools[NEW_BLOCK_TYPE].render({\n                text : newNode,\n            })\n        }, true );\n\n    };\n\n    /**\n     * Merges two blocks — current and target\n     * If target index is not exist, then previous will be as target\n     */\n    content.mergeBlocks = function(currentInputIndex, targetInputIndex) {\n\n        /** If current input index is zero, then prevent method execution */\n        if (currentInputIndex === 0) {\n            return;\n        }\n\n        var targetInput,\n            currentInputContent = codex.state.inputs[currentInputIndex].innerHTML;\n\n        if (!targetInputIndex) {\n\n            targetInput = codex.state.inputs[currentInputIndex - 1];\n\n        } else {\n\n            targetInput = codex.state.inputs[targetInputIndex];\n\n        }\n\n        targetInput.innerHTML += currentInputContent;\n    };\n\n    /**\n     * @private\n     *\n     * Callback for HTML Mutations\n     * @param {Array} mutation - Mutation Record\n     */\n    content.paste = function(mutation) {\n\n        var workingNode = codex.content.currentNode,\n            tool        = workingNode.dataset.tool;\n\n        if (codex.tools[tool].allowedToPaste) {\n            codex.content.sanitize(mutation.addedNodes);\n        } else {\n            codex.content.pasteTextContent(mutation.addedNodes);\n        }\n\n    };\n\n    /**\n     * @private\n     *\n     * gets only text/plain content of node\n     * @param {Element} target - HTML node\n     */\n    content.pasteTextContent = function(nodes) {\n\n        var node     = nodes[0],\n            textNode = document.createTextNode(node.textContent);\n\n        if (codex.core.isDomNode(node)) {\n            node.parentNode.replaceChild(textNode, node);\n        }\n    };\n\n    /**\n     * @private\n     *\n     * Sanitizes HTML content\n     * @param {Element} target - inserted element\n     * @uses DFS function for deep searching\n     */\n    content.sanitize = function(target) {\n\n        if (!target) {\n            return;\n        }\n\n        for (var i = 0; i < target.childNodes.length; i++) {\n            this.dfs(target.childNodes[i]);\n        }\n    };\n\n    /**\n     * Clears styles\n     * @param {Element|Text}\n     */\n    content.clearStyles = function(target) {\n\n        var href,\n            newNode = null,\n            blockTags   = ['P', 'BLOCKQUOTE', 'UL', 'CODE', 'OL', 'LI', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'DIV', 'PRE', 'HEADER', 'SECTION'],\n            allowedTags = ['P', 'B', 'I', 'A', 'U', 'BR'],\n            needReplace = !allowedTags.includes(target.tagName),\n            isDisplayedAsBlock = blockTags.includes(target.tagName);\n\n        if (!codex.core.isDomNode(target)){\n            return target;\n        }\n\n        if (!target.parentNode){\n            return target;\n        }\n\n        if (needReplace) {\n\n            if (isDisplayedAsBlock) {\n\n                newNode = document.createElement('P');\n                newNode.innerHTML = target.innerHTML;\n                target.parentNode.replaceChild(newNode, target);\n                target = newNode;\n\n            } else {\n\n                newNode = document.createTextNode(` ${target.textContent} `);\n                newNode.textContent = newNode.textContent.replace(/\\s{2,}/g, ' ');\n                target.parentNode.replaceChild(newNode, target);\n\n            }\n        }\n\n        /** keep href attributes of tag A */\n        if (target.tagName == 'A') {\n            href = target.getAttribute('href');\n        }\n\n        /** Remove all tags */\n        while(target.attributes.length > 0) {\n            target.removeAttribute(target.attributes[0].name);\n        }\n\n        /** return href */\n        if (href) {\n            target.setAttribute('href', href);\n        }\n\n        return target;\n\n    };\n\n    /**\n     * Depth-first search Algorithm\n     * returns all childs\n     * @param {Element}\n     */\n    content.dfs = function(el) {\n\n        if (!codex.core.isDomNode(el))\n            return;\n\n        var sanitized = this.clearStyles(el);\n\n        for(var i = 0; i < sanitized.childNodes.length; i++) {\n            this.dfs(sanitized.childNodes[i]);\n        }\n\n    };\n\n    return content;\n\n})({});\n\ncodex.content = content;\nmodule.exports = content;\n\n\n/** WEBPACK FOOTER **\n ** ./modules/content.js\n **/","var codex = require('../../editor');\n\nvar toolbar = (function(toolbar) {\n\n    toolbar.init = function() {\n        toolbar.settings = require('./settings');\n        toolbar.inline   = require('./inline');\n        toolbar.toolbox  = require('./toolbox');\n    };\n\n    /**\n     * Margin between focused node and toolbar\n     */\n    toolbar.defaultToolbarHeight = 49;\n\n    toolbar.defaultOffset = 34;\n\n    toolbar.opened = false;\n\n    toolbar.current = null;\n\n    /**\n     * @protected\n     */\n    toolbar.open = function (){\n\n        codex.nodes.toolbar.classList.add('opened');\n        this.opened = true;\n\n    };\n\n    /**\n     * @protected\n     */\n    toolbar.close = function(){\n\n        codex.nodes.toolbar.classList.remove('opened');\n        this.opened  = false;\n\n        this.current = null;\n\n        for (var button in codex.nodes.toolbarButtons){\n            codex.nodes.toolbarButtons[button].classList.remove('selected');\n        }\n\n        /** Close toolbox when toolbar is not displayed */\n        codex.toolbar.toolbox.close();\n        codex.toolbar.settings.close();\n\n    };\n\n    toolbar.toggle = function(){\n\n        if ( !this.opened ){\n\n            this.open();\n\n        } else {\n\n            this.close();\n\n        }\n\n    };\n\n    toolbar.hidePlusButton = function() {\n        codex.nodes.plusButton.classList.add('hide');\n    };\n\n    toolbar.showPlusButton = function() {\n        codex.nodes.plusButton.classList.remove('hide');\n    };\n\n    /**\n     * Moving toolbar to the specified node\n     */\n    toolbar.move = function() {\n\n        /** Close Toolbox when we move toolbar */\n        codex.toolbar.toolbox.close();\n\n        if (!codex.content.currentNode) {\n            return;\n        }\n\n        var toolbarHeight = codex.nodes.toolbar.clientHeight || codex.toolbar.defaultToolbarHeight,\n            newYCoordinate = codex.content.currentNode.offsetTop - (codex.toolbar.defaultToolbarHeight / 2) + codex.toolbar.defaultOffset;\n\n        codex.nodes.toolbar.style.transform = `translate3D(0, ${Math.floor(newYCoordinate)}px, 0)`;\n\n        /** Close trash actions */\n        codex.toolbar.settings.hideRemoveActions();\n\n    };\n\n    return toolbar;\n\n})({});\n\ntoolbar.init();\n\ncodex.toolbar = toolbar;\nmodule.exports = toolbar;\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./modules/toolbar/toolbar.js\n **/","var codex = require('../../editor');\n\nvar settings = (function(settings) {\n\n    settings.init = function() {\n        require('../content');\n    };\n\n    settings.opened = false;\n\n    settings.setting = null;\n    settings.actions = null;\n\n    settings.cover = null;\n\n    /**\n     * Append and open settings\n     */\n    settings.open = function(toolType){\n\n        /**\n         * Append settings content\n         * It's stored in tool.settings\n         */\n        if (!codex.tools[toolType] || !codex.core.isDomNode(codex.tools[toolType].settings) ) {\n\n            codex.core.log(`Plugin «${toolType}» has no settings`, 'warn');\n            // codex.nodes.pluginSettings.innerHTML = `Плагин «${toolType}» не имеет настроек`;\n\n        } else {\n\n            codex.nodes.pluginSettings.appendChild(codex.tools[toolType].settings);\n\n        }\n\n        var currentBlock = codex.content.currentNode;\n\n        /** Open settings block */\n        codex.nodes.blockSettings.classList.add('opened');\n        codex.toolbar.settings.addDefaultSettings();\n        this.opened = true;\n    };\n\n    /**\n     * Close and clear settings\n     */\n    settings.close = function(){\n\n        codex.nodes.blockSettings.classList.remove('opened');\n        codex.nodes.pluginSettings.innerHTML = '';\n\n        this.opened = false;\n\n    };\n\n    /**\n     * @param {string} toolType - plugin type\n     */\n    settings.toggle = function( toolType ){\n\n        if ( !this.opened ){\n\n            this.open(toolType);\n\n        } else {\n\n            this.close();\n\n        }\n\n    };\n\n    /**\n     * This function adds default core settings\n     */\n    settings.addDefaultSettings = function() {\n\n        /** list of default settings */\n        var feedModeToggler;\n\n        /** Clear block and append initialized settings */\n        codex.nodes.defaultSettings.innerHTML = '';\n\n\n        /** Init all default setting buttons */\n        feedModeToggler = codex.toolbar.settings.makeFeedModeToggler();\n\n        /**\n         * Fill defaultSettings\n         */\n\n        /**\n         * Button that enables/disables Feed-mode\n         * Feed-mode means that block will be showed in articles-feed like cover\n         */\n        codex.nodes.defaultSettings.appendChild(feedModeToggler);\n\n    };\n\n    /**\n     * Cover setting.\n     * This tune highlights block, so that it may be used for showing target block on main page\n     * Draw different setting when block is marked for main page\n     * If TRUE, then we show button that removes this selection\n     * Also defined setting \"Click\" events will be listened and have separate callbacks\n     *\n     * @return {Element} node/button that we place in default settings block\n     */\n    settings.makeFeedModeToggler = function() {\n\n        var isFeedModeActivated = codex.toolbar.settings.isFeedModeActivated(),\n            setting,\n            data;\n\n        if (!isFeedModeActivated) {\n\n            data = {\n                innerHTML : '<i class=\"ce-icon-newspaper\"></i>Вывести в ленте'\n            };\n\n        } else {\n\n            data = {\n                innerHTML : '<i class=\"ce-icon-newspaper\"></i>Не выводить в ленте'\n            };\n\n        }\n\n        setting = codex.draw.node('DIV', codex.ui.className.SETTINGS_ITEM, data);\n        setting.addEventListener('click', codex.toolbar.settings.updateFeedMode, false);\n\n        return setting;\n    };\n\n    /**\n     * Updates Feed-mode\n     */\n    settings.updateFeedMode = function() {\n\n        var currentNode = codex.content.currentNode;\n\n        currentNode.classList.toggle(codex.ui.className.BLOCK_IN_FEED_MODE);\n\n        codex.toolbar.settings.close();\n    };\n\n    settings.isFeedModeActivated = function() {\n\n        var currentBlock = codex.content.currentNode;\n\n        if (currentBlock) {\n            return currentBlock.classList.contains(codex.ui.className.BLOCK_IN_FEED_MODE);\n        } else {\n            return false;\n        }\n    };\n\n    /**\n     * Here we will draw buttons and add listeners to components\n     */\n    settings.makeRemoveBlockButton = function() {\n\n        var removeBlockWrapper  = codex.draw.node('SPAN', 'ce-toolbar__remove-btn', {}),\n            settingButton = codex.draw.node('SPAN', 'ce-toolbar__remove-setting', { innerHTML : '<i class=\"ce-icon-trash\"></i>' }),\n            actionWrapper = codex.draw.node('DIV', 'ce-toolbar__remove-confirmation', {}),\n            confirmAction = codex.draw.node('DIV', 'ce-toolbar__remove-confirm', { textContent : 'Удалить блок' }),\n            cancelAction  = codex.draw.node('DIV', 'ce-toolbar__remove-cancel', { textContent : 'Отменить удаление' });\n\n        settingButton.addEventListener('click', codex.toolbar.settings.removeButtonClicked, false);\n\n        confirmAction.addEventListener('click', codex.toolbar.settings.confirmRemovingRequest, false);\n\n        cancelAction.addEventListener('click', codex.toolbar.settings.cancelRemovingRequest, false);\n\n        actionWrapper.appendChild(confirmAction);\n        actionWrapper.appendChild(cancelAction);\n\n        removeBlockWrapper.appendChild(settingButton);\n        removeBlockWrapper.appendChild(actionWrapper);\n\n        /** Save setting */\n        codex.toolbar.settings.setting = settingButton;\n        codex.toolbar.settings.actions = actionWrapper;\n\n        return removeBlockWrapper;\n\n    };\n\n    settings.removeButtonClicked = function() {\n\n        var action = codex.toolbar.settings.actions;\n\n        if (action.classList.contains('opened')) {\n            codex.toolbar.settings.hideRemoveActions();\n        } else {\n            codex.toolbar.settings.showRemoveActions();\n        }\n\n        codex.toolbar.toolbox.close();\n        codex.toolbar.settings.close();\n\n    };\n\n    settings.cancelRemovingRequest = function() {\n\n        codex.toolbar.settings.actions.classList.remove('opened');\n    };\n\n    settings.confirmRemovingRequest = function() {\n\n        var currentBlock = codex.content.currentNode,\n            firstLevelBlocksCount;\n\n        currentBlock.remove();\n\n        firstLevelBlocksCount = codex.nodes.redactor.childNodes.length;\n\n        /**\n         * If all blocks are removed\n         */\n        if (firstLevelBlocksCount === 0) {\n\n            /** update currentNode variable */\n            codex.content.currentNode = null;\n\n            /** Inserting new empty initial block */\n            codex.ui.addInitialBlock();\n        }\n\n        codex.ui.saveInputs();\n\n        codex.toolbar.close();\n    };\n\n    settings.showRemoveActions = function() {\n        codex.toolbar.settings.actions.classList.add('opened');\n    };\n\n    settings.hideRemoveActions = function() {\n        codex.toolbar.settings.actions.classList.remove('opened');\n    };\n\n    return settings;\n\n})({});\n\nsettings.init();\n\nmodule.exports = settings;\n\n\n/** WEBPACK FOOTER **\n ** ./modules/toolbar/settings.js\n **/","var codex = require('../../editor');\n\nvar inline = (function(inline) {\n\n    inline.init = function() {\n\n    };\n\n    inline.buttonsOpened = null;\n    inline.actionsOpened = null;\n    inline.wrappersOffset = null;\n\n    /**\n     * saving selection that need for execCommand for styling\n     *\n     */\n    inline.storedSelection = null,\n\n    /**\n     * @protected\n     *\n     * Open inline toobar\n     */\n    inline.show = function() {\n\n        var selectedText = this.getSelectionText(),\n            toolbar      = codex.nodes.inlineToolbar.wrapper,\n            buttons      = codex.nodes.inlineToolbar.buttons;\n\n        if (selectedText.length > 0) {\n\n            /** Move toolbar and open */\n            codex.toolbar.inline.move();\n\n            /** Open inline toolbar */\n            toolbar.classList.add('opened');\n\n            /** show buttons of inline toolbar */\n            codex.toolbar.inline.showButtons();\n        }\n\n    };\n\n    /**\n     * @protected\n     *\n     * Closes inline toolbar\n     */\n    inline.close = function() {\n        var toolbar = codex.nodes.inlineToolbar.wrapper;\n        toolbar.classList.remove('opened');\n    };\n\n    /**\n     * @private\n     *\n     * Moving toolbar\n     */\n    inline.move = function() {\n\n        if (!this.wrappersOffset) {\n            this.wrappersOffset = this.getWrappersOffset();\n        }\n\n        var coords          = this.getSelectionCoords(),\n            defaultOffset   = 0,\n            toolbar         = codex.nodes.inlineToolbar.wrapper,\n            newCoordinateX,\n            newCoordinateY;\n\n        if (toolbar.offsetHeight === 0) {\n            defaultOffset = 40;\n        }\n\n        newCoordinateX = coords.x - this.wrappersOffset.left;\n        newCoordinateY = coords.y + window.scrollY - this.wrappersOffset.top - defaultOffset - toolbar.offsetHeight;\n\n        toolbar.style.transform = `translate3D(${Math.floor(newCoordinateX)}px, ${Math.floor(newCoordinateY)}px, 0)`;\n\n        /** Close everything */\n        codex.toolbar.inline.closeButtons();\n        codex.toolbar.inline.closeAction();\n\n    };\n\n    /**\n     * @private\n     *\n     * Tool Clicked\n     */\n\n    inline.toolClicked = function(event, type) {\n\n        /**\n         * For simple tools we use default browser function\n         * For more complicated tools, we should write our own behavior\n         */\n        switch (type) {\n            case 'createLink' : codex.toolbar.inline.createLinkAction(event, type); break;\n            default           : codex.toolbar.inline.defaultToolAction(type); break;\n        }\n\n        /**\n         * highlight buttons\n         * after making some action\n         */\n        codex.nodes.inlineToolbar.buttons.childNodes.forEach(codex.toolbar.inline.hightlight);\n    };\n\n    /**\n     * @private\n     *\n     * Saving wrappers offset in DOM\n     */\n    inline.getWrappersOffset = function() {\n\n        var wrapper = codex.nodes.wrapper,\n            offset  = this.getOffset(wrapper);\n\n        this.wrappersOffset = offset;\n        return offset;\n\n    };\n\n    /**\n     * @private\n     *\n     * Calculates offset of DOM element\n     *\n     * @param el\n     * @returns {{top: number, left: number}}\n     */\n    inline.getOffset = function ( el ) {\n\n        var _x = 0;\n        var _y = 0;\n\n        while( el && !isNaN( el.offsetLeft ) && !isNaN( el.offsetTop ) ) {\n            _x += (el.offsetLeft + el.clientLeft);\n            _y += (el.offsetTop + el.clientTop);\n            el = el.offsetParent;\n        }\n        return { top: _y, left: _x };\n    };\n\n    /**\n     * @private\n     *\n     * Calculates position of selected text\n     * @returns {{x: number, y: number}}\n     */\n    inline.getSelectionCoords = function() {\n\n        var sel = document.selection, range;\n        var x = 0, y = 0;\n\n        if (sel) {\n\n            if (sel.type != \"Control\") {\n                range = sel.createRange();\n                range.collapse(true);\n                x = range.boundingLeft;\n                y = range.boundingTop;\n            }\n\n        } else if (window.getSelection) {\n\n            sel = window.getSelection();\n\n            if (sel.rangeCount) {\n\n                range = sel.getRangeAt(0).cloneRange();\n                if (range.getClientRects) {\n                    range.collapse(true);\n                    var rect = range.getClientRects()[0];\n                    x = rect.left;\n                    y = rect.top;\n                }\n\n            }\n        }\n        return { x: x, y: y };\n    };\n\n    /**\n     * @private\n     *\n     * Returns selected text as String\n     * @returns {string}\n     */\n    inline.getSelectionText = function getSelectionText(){\n\n        var selectedText = \"\";\n\n        if (window.getSelection){ // all modern browsers and IE9+\n            selectedText = window.getSelection().toString();\n        }\n\n        return selectedText;\n    };\n\n    /** Opens buttons block */\n    inline.showButtons = function() {\n\n        var buttons = codex.nodes.inlineToolbar.buttons;\n        buttons.classList.add('opened');\n\n        codex.toolbar.inline.buttonsOpened = true;\n\n        /** highlight buttons */\n        codex.nodes.inlineToolbar.buttons.childNodes.forEach(codex.toolbar.inline.hightlight);\n\n    };\n\n    /** Makes buttons disappear */\n    inline.closeButtons = function() {\n        var buttons = codex.nodes.inlineToolbar.buttons;\n        buttons.classList.remove('opened');\n\n        codex.toolbar.inline.buttonsOpened = false;\n    };\n\n    /** Open buttons defined action if exist */\n    inline.showActions = function() {\n        var action = codex.nodes.inlineToolbar.actions;\n        action.classList.add('opened');\n\n        codex.toolbar.inline.actionsOpened = true;\n    };\n\n    /** Close actions block */\n    inline.closeAction = function() {\n        var action = codex.nodes.inlineToolbar.actions;\n        action.innerHTML = '';\n        action.classList.remove('opened');\n        codex.toolbar.inline.actionsOpened = false;\n    };\n\n    /** Action for link creation or for setting anchor */\n    inline.createLinkAction = function(event, type) {\n\n        var isActive = this.isLinkActive();\n\n        var editable        = codex.content.currentNode,\n            storedSelection = codex.toolbar.inline.storedSelection;\n\n        if (isActive) {\n\n            var selection   = window.getSelection(),\n                anchorNode  = selection.anchorNode;\n\n            storedSelection = codex.toolbar.inline.saveSelection(editable);\n\n            /**\n             * Changing stored selection. if we want to remove anchor from word\n             * we should remove anchor from whole word, not only selected part.\n             * The solution is than we get the length of current link\n             * Change start position to - end of selection minus length of anchor\n             */\n            codex.toolbar.inline.restoreSelection(editable, storedSelection);\n\n            codex.toolbar.inline.defaultToolAction('unlink');\n\n        } else {\n\n            /** Create input and close buttons */\n            var action = codex.draw.inputForLink();\n            codex.nodes.inlineToolbar.actions.appendChild(action);\n\n            codex.toolbar.inline.closeButtons();\n            codex.toolbar.inline.showActions();\n\n            storedSelection = codex.toolbar.inline.saveSelection(editable);\n\n            /**\n             * focus to input\n             * Solution: https://developer.mozilla.org/ru/docs/Web/API/HTMLElement/focus\n             * Prevents event after showing input and when we need to focus an input which is in unexisted form\n             */\n            action.focus();\n            event.preventDefault();\n\n            /** Callback to link action */\n            action.addEventListener('keydown', function(event){\n\n                if (event.keyCode == codex.core.keys.ENTER) {\n\n                    codex.toolbar.inline.restoreSelection(editable, storedSelection);\n                    codex.toolbar.inline.setAnchor(action.value);\n\n                    /**\n                     * Preventing events that will be able to happen\n                     */\n                    event.preventDefault();\n                    event.stopImmediatePropagation();\n\n                    codex.toolbar.inline.clearRange();\n                }\n\n            }, false);\n        }\n    };\n\n    inline.isLinkActive = function() {\n\n        var isActive = false;\n\n        codex.nodes.inlineToolbar.buttons.childNodes.forEach(function(tool) {\n            var dataType = tool.dataset.type;\n\n            if (dataType == 'link' && tool.classList.contains('hightlighted')) {\n                isActive = true;\n            }\n        });\n\n        return isActive;\n    };\n\n    /** default action behavior of tool */\n    inline.defaultToolAction = function(type) {\n        document.execCommand(type, false, null);\n    };\n\n    /**\n     * @private\n     *\n     * Sets URL\n     *\n     * @param {String} url - URL\n     */\n    inline.setAnchor = function(url) {\n\n        document.execCommand('createLink', false, url);\n\n        /** Close after URL inserting */\n        codex.toolbar.inline.closeAction();\n    };\n\n    /**\n     * @private\n     *\n     * Saves selection\n     */\n    inline.saveSelection = function(containerEl) {\n\n        var range = window.getSelection().getRangeAt(0),\n            preSelectionRange = range.cloneRange(),\n            start;\n\n        preSelectionRange.selectNodeContents(containerEl);\n        preSelectionRange.setEnd(range.startContainer, range.startOffset);\n\n        start = preSelectionRange.toString().length;\n\n        return {\n            start: start,\n            end: start + range.toString().length\n        };\n    };\n\n    /**\n     * @private\n     *\n     * Sets to previous selection (Range)\n     *\n     * @param {Element} containerEl - editable element where we restore range\n     * @param {Object} savedSel - range basic information to restore\n     */\n    inline.restoreSelection = function(containerEl, savedSel) {\n\n        var range     = document.createRange(),\n            charIndex = 0;\n\n        range.setStart(containerEl, 0);\n        range.collapse(true);\n\n        var nodeStack = [containerEl],\n            node,\n            foundStart = false,\n            stop = false,\n            nextCharIndex;\n\n        while (!stop && (node = nodeStack.pop())) {\n\n            if (node.nodeType == 3) {\n\n                nextCharIndex = charIndex + node.length;\n\n                if (!foundStart && savedSel.start >= charIndex && savedSel.start <= nextCharIndex) {\n                    range.setStart(node, savedSel.start - charIndex);\n                    foundStart = true;\n                }\n                if (foundStart && savedSel.end >= charIndex && savedSel.end <= nextCharIndex) {\n                    range.setEnd(node, savedSel.end - charIndex);\n                    stop = true;\n                }\n                charIndex = nextCharIndex;\n            } else {\n                var i = node.childNodes.length;\n                while (i--) {\n                    nodeStack.push(node.childNodes[i]);\n                }\n            }\n        }\n\n        var sel = window.getSelection();\n        sel.removeAllRanges();\n        sel.addRange(range);\n    };\n\n    /**\n     * @private\n     *\n     * Removes all ranges from window selection\n     */\n    inline.clearRange = function() {\n        var selection = window.getSelection();\n        selection.removeAllRanges();\n    };\n\n    /**\n     * @private\n     *\n     * sets or removes hightlight\n     */\n    inline.hightlight = function(tool) {\n        var dataType = tool.dataset.type;\n\n        if (document.queryCommandState(dataType)) {\n            codex.toolbar.inline.setButtonHighlighted(tool);\n        } else {\n            codex.toolbar.inline.removeButtonsHighLight(tool);\n        }\n\n        /**\n         *\n         * hightlight for anchors\n         */\n        var selection = window.getSelection(),\n            tag = selection.anchorNode.parentNode;\n\n        if (tag.tagName == 'A' && dataType == 'link') {\n            codex.toolbar.inline.setButtonHighlighted(tool);\n        }\n    };\n\n    /**\n     * @private\n     *\n     * Mark button if text is already executed\n     */\n    inline.setButtonHighlighted = function(button) {\n        button.classList.add('hightlighted');\n\n        /** At link tool we also change icon */\n        if (button.dataset.type == 'link') {\n            var icon = button.childNodes[0];\n            icon.classList.remove('ce-icon-link');\n            icon.classList.add('ce-icon-unlink');\n        }\n    };\n\n    /**\n     * @private\n     *\n     * Removes hightlight\n     */\n    inline.removeButtonsHighLight = function(button) {\n        button.classList.remove('hightlighted');\n\n        /** At link tool we also change icon */\n        if (button.dataset.type == 'link') {\n            var icon = button.childNodes[0];\n            icon.classList.remove('ce-icon-unlink');\n            icon.classList.add('ce-icon-link');\n        }\n    };\n\n\n    return inline;\n})({});\n\ninline.init();\n\nmodule.exports = inline;\n\n\n/** WEBPACK FOOTER **\n ** ./modules/toolbar/inline.js\n **/","var codex = require('../../editor');\n\nvar toolbox = (function(toolbox) {\n\n    toolbox.init = function() {\n        require('./toolbar');\n    };\n\n    toolbox.opened = false;\n\n    /** Shows toolbox */\n    toolbox.open = function() {\n\n        /** Close setting if toolbox is opened */\n        if (codex.toolbar.settings.opened) {\n            codex.toolbar.settings.close();\n        }\n\n        /** display toolbox */\n        codex.nodes.toolbox.classList.add('opened');\n\n        /** Animate plus button */\n        codex.nodes.plusButton.classList.add('clicked');\n\n        /** toolbox state */\n        codex.toolbar.toolbox.opened = true;\n\n    };\n\n    /** Closes toolbox */\n    toolbox.close = function() {\n\n        /** Makes toolbox disapear */\n        codex.nodes.toolbox.classList.remove('opened');\n\n        /** Rotate plus button */\n        codex.nodes.plusButton.classList.remove('clicked');\n\n        /** toolbox state */\n        codex.toolbar.toolbox.opened = false;\n\n    };\n\n    toolbox.leaf = function(){\n\n        var currentTool = codex.toolbar.current,\n            tools       = Object.keys(codex.tools),\n            barButtons  = codex.nodes.toolbarButtons,\n            nextToolIndex,\n            toolToSelect;\n\n        if ( !currentTool ) {\n\n            /** Get first tool from object*/\n            for (toolToSelect in barButtons) break;\n\n        } else {\n\n            nextToolIndex = tools.indexOf(currentTool) + 1;\n\n            if ( nextToolIndex == tools.length) nextToolIndex = 0;\n\n            toolToSelect = tools[nextToolIndex];\n\n        }\n\n        for (var button in barButtons) barButtons[button].classList.remove('selected');\n\n        barButtons[toolToSelect].classList.add('selected');\n\n        codex.toolbar.current = toolToSelect;\n\n    };\n\n    /**\n     * Transforming selected node type into selected toolbar element type\n     * @param {event} event\n     */\n    toolbox.toolClicked = function() {\n\n        /**\n         * UNREPLACEBLE_TOOLS this types of tools are forbidden to replace even they are empty\n         */\n        var UNREPLACEBLE_TOOLS = ['image', 'link', 'list', 'instagram', 'twitter'],\n            tool               = codex.tools[codex.toolbar.current],\n            workingNode        = codex.content.currentNode,\n            currentInputIndex  = codex.caret.inputIndex,\n            newBlockContent,\n            appendCallback,\n            blockData;\n\n        /** Make block from plugin */\n        newBlockContent = tool.make();\n\n        /** information about block */\n        blockData = {\n            block     : newBlockContent,\n            type      : tool.type,\n            stretched : false\n        };\n\n        if (\n            workingNode &&\n            UNREPLACEBLE_TOOLS.indexOf(workingNode.dataset.tool) === -1 &&\n            workingNode.textContent.trim() === ''\n        ){\n            /** Replace current block */\n            codex.content.switchBlock(workingNode, newBlockContent, tool.type);\n\n        } else {\n\n            /** Insert new Block from plugin */\n            codex.content.insertBlock(blockData);\n\n            /** increase input index */\n            currentInputIndex++;\n\n        }\n\n        /** Fire tool append callback  */\n        appendCallback = tool.appendCallback;\n\n        if (appendCallback && typeof appendCallback == 'function') {\n            appendCallback.call(event);\n        }\n\n        setTimeout(function() {\n\n            /** Set caret to current block */\n            codex.caret.setToBlock(currentInputIndex);\n\n        }, 10);\n\n\n        /**\n         * Changing current Node\n         */\n        codex.content.workingNodeChanged();\n\n        /**\n         * Move toolbar when node is changed\n         */\n        codex.toolbar.move();\n    };\n\n    return toolbox;\n\n})({});\n\ntoolbox.init();\n\nmodule.exports = toolbox;\n\n\n/** WEBPACK FOOTER **\n ** ./modules/toolbar/toolbox.js\n **/","var codex = require('../editor');\n\nvar tools = (function(tools) {\n\n    tools.init = function() {\n\n        tools.paragraph = require('./plugins/paragraph/paragraph');\n        // tools.header    = require('./plugins/header/header');\n        tools.code      = require('./plugins/code/code');\n        tools.link      = require('./plugins/link/link');\n        tools.list      = require('./plugins/list/list');\n        tools.quote     = require('./plugins/quote/quote');\n        tools.image     = require('./plugins/image/image');\n        tools.instagram = require('./plugins/instagram/instagram');\n        tools.twitter   = require('./plugins/twitter/twitter');\n        tools.paste     = require('./plugins/paste/paste');\n\n    };\n\n    return tools;\n\n})({});\n\ntools.init();\n\ncodex.tools = tools;\nmodule.exports = tools;\n\n\n\n/** WEBPACK FOOTER **\n ** ./modules/tools.js\n **/","/**\n * Paragraph Plugin\n * Creates P tag and adds content to this tag\n *\n * @author Codex Team\n * @copyright Khaydarov Murod\n */\n\n/** Include to Build css */\nrequire('./paragraph.css');\n\nvar codex = require('../../../editor');\nvar paragraphTool = {\n\n    /**\n    * Make initial header block\n    * @param {object} JSON with block data\n    * @return {Element} element to append\n    */\n    make : function (data) {\n\n        var tag = document.createElement('DIV');\n\n        tag.classList.add('ce-paragraph');\n\n        if (data && data.text) {\n            tag.innerHTML = data.text;\n        }\n\n        tag.contentEditable = true;\n\n        /**\n         * if plugin need to add placeholder\n         * tag.setAttribute('data-placeholder', 'placehoder');\n         */\n\n        /**\n         * @uses Paste tool callback.\n         * Function analyzes pasted data\n         * If pasted URL from instagram, twitter or Image\n         * it renders via Social widgets content or uploads image and uses Image tool to render\n         */\n        tag.addEventListener('paste', codex.tools.paste.callbacks.pasted, false);\n\n        return tag;\n\n    },\n\n    /**\n    * Method to render HTML block from JSON\n    */\n    render : function (data) {\n\n       return paragraphTool.make(data);\n\n    },\n\n    /**\n    * Method to extract JSON data from HTML block\n    */\n    save : function (blockContent){\n\n        var data = {\n                text : null,\n            };\n\n        data.text = blockContent.innerHTML;\n\n        return data;\n\n    },\n\n};\n\n/**\n* Now plugin is ready.\n* Add it to redactor tools\n*/\nmodule.exports = {\n\n    type             : 'paragraph',\n    iconClassname    : 'ce-icon-paragraph',\n    make             : paragraphTool.make,\n    appendCallback   : null,\n    settings         : null,\n    render           : paragraphTool.render,\n    save             : paragraphTool.save,\n    displayInToolbox : false,\n    enableLineBreaks : false,\n    allowedToPaste   : true\n\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./modules/plugins/paragraph/paragraph.js\n **/","// removed by extract-text-webpack-plugin\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./modules/plugins/paragraph/paragraph.css\n ** module id = 14\n ** module chunks = 0\n **/","/**\n * Code Plugin\n * Creates code tag and adds content to this tag\n *\n * @author Codex Team\n * @version 1.0.0\n */\n\n/** Include to Build css */\nrequire('./code.css');\n\nvar codeTool = {\n\n    baseClass : \"ce-code\",\n\n    /**\n     * Make initial header block\n     * @param {object} JSON with block data\n     * @return {Element} element to append\n     */\n    make : function (data) {\n\n        var tag = document.createElement('code');\n\n        tag.classList.add(codeTool.baseClass);\n\n        if (data && data.text) {\n            tag.innerHTML = data.text;\n        }\n\n        tag.contentEditable = true;\n\n        return tag;\n\n    },\n\n    /**\n     * Method to render HTML block from JSON\n     */\n    render : function (data) {\n\n        return codeTool.make(data);\n\n    },\n\n    /**\n     * Method to extract JSON data from HTML block\n     */\n    save : function (blockContent){\n\n        var data = {\n                text : null,\n            };\n\n        data.text = blockContent.innerHTML;\n\n        return data;\n\n    },\n\n};\n\n/**\n * Now plugin is ready.\n * Add it to redactor tools\n */\nmodule.exports = {\n\n    type             : 'code',\n    iconClassname    : 'ce-icon-code',\n    make             : codeTool.make,\n    appendCallback   : null,\n    settings         : null,\n    render           : codeTool.render,\n    save             : codeTool.save,\n    displayInToolbox : true,\n    enableLineBreaks : true\n\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./modules/plugins/code/code.js\n **/","// removed by extract-text-webpack-plugin\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./modules/plugins/code/code.css\n ** module id = 19\n ** module chunks = 0\n **/","/**\n * Link tool plugin\n *\n * @author Codex Team\n * @copyright n0str\n * @version 1.0.0\n */\n\n/** Include to Build css */\nrequire('./link.css');\n\nvar codex = require('../../../editor');\nvar linkTool = {\n\n    defaultText    : 'Insert link here ...',\n    ENTER_KEY      : 13,\n\n    currentBlock   : null,\n    currentInput   : null,\n    elementClasses : {\n        link        : \"tool-link-link\",\n        image       : \"tool-link-image\",\n        title       : \"tool-link-title\",\n        description : \"tool-link-description\",\n        loader      : \"ce-redactor__loader\",\n        error       : \"tool-link-error\"\n    },\n\n    /**\n     * Make initial header block\n     * @param {object} JSON with block data\n     * @return {Element} element to append\n     */\n    makeNewBlock : function (data) {\n\n        var wrapper = linkTool.ui.mainBlock(),\n            tag     = linkTool.ui.input();\n\n        linkTool.currentInput = tag;\n\n        wrapper.appendChild(tag);\n\n        wrapper.classList.add('ce-link');\n        /**\n        * Bind callbacks\n        **/\n        tag.addEventListener('paste', linkTool.blockPasteCallback, false);\n        tag.addEventListener('keydown', linkTool.blockKeyDownCallback, false);\n\n        return wrapper;\n\n    },\n\n    /**\n     * Method to render HTML block from JSON\n     */\n    render : function (json) {\n\n        var block = linkTool.ui.mainBlock(),\n            tag   = linkTool.ui.make(json);\n\n        block.classList.add('ce-link');\n        block.appendChild(tag);\n\n        return block;\n\n    },\n\n    /**\n     * Method to extract JSON data from HTML block\n     */\n    save : function (blockContent){\n\n        var linkElement = linkTool.elementClasses.link;\n\n        var data = {\n                fullLink    : blockContent.querySelector(\".\" + linkElement).href,\n                shortLink   : blockContent.querySelector(\".\" + linkElement).textContent,\n                image       : blockContent.querySelector(\".\" + linkTool.elementClasses.image).src,\n                title       : blockContent.querySelector(\".\" + linkTool.elementClasses.title).textContent,\n                description : blockContent.querySelector(\".\" + linkTool.elementClasses.description).textContent\n            };\n\n        return data;\n\n    },\n\n    blockPasteCallback : function (event) {\n\n        var clipboardData = event.clipboardData || window.clipboardData,\n            pastedData    = clipboardData.getData('Text'),\n            block         = event.target.parentNode;\n\n        linkTool.renderLink(pastedData, block);\n\n        event.stopPropagation();\n\n    },\n\n    blockKeyDownCallback : function (event) {\n\n        var inputTag = event.target,\n            block    = inputTag.parentNode,\n            url;\n\n        if ( block.classList.contains(linkTool.elementClasses.error) )\n        {\n            block.classList.remove(linkTool.elementClasses.error);\n        }\n\n        if (event.keyCode == linkTool.ENTER_KEY) {\n\n            url = inputTag.value;\n\n            linkTool.renderLink(url, block);\n\n            event.preventDefault();\n\n        }\n\n    },\n\n    /**\n    * @todo move request-url to accepted settings\n    */\n    renderLink : function (url, block) {\n\n        Promise.resolve()\n\n            .then(function () {\n                return linkTool.urlify(url);\n            })\n\n            .then(function (url) {\n\n                /* Show loader gif **/\n                block.classList.add(linkTool.elementClasses.loader);\n\n                return fetch('/editor/parseLink?url=' + encodeURI(url));\n            })\n\n            .then(function (response) {\n\n                if (response.status == \"200\"){\n\n                    return response.json();\n\n                } else {\n\n                    return Error(\"Invalid response status: %o\", response);\n\n                }\n\n            })\n\n            .then(function (json) {\n                linkTool.composeLinkPreview(json, block);\n            })\n\n            .catch(function(error) {\n\n                /* Hide loader gif **/\n                block.classList.remove(linkTool.elementClasses.loader);\n\n                block.classList.add(linkTool.elementClasses.error);\n\n                codex.core.log('Error while doing things with link paste: %o', 'error', error);\n            });\n\n    },\n\n    urlify : function (text) {\n\n        var urlRegex = /(https?:\\/\\/\\S+)/g;\n\n        var links = text.match(urlRegex);\n\n        if (links) {\n            return links[0];\n        }\n\n        return Promise.reject(Error(\"Url is not matched\"));\n\n    },\n\n    composeLinkPreview : function (json, currentBlock) {\n\n        if (json == {}) {\n\n            return;\n\n        }\n\n        var previewBlock = linkTool.ui.make(json);\n\n        linkTool.currentInput.remove();\n\n        currentBlock.appendChild(previewBlock);\n\n        currentBlock.classList.remove(linkTool.elementClasses.loader);\n\n    }\n\n};\n\nlinkTool.ui = {\n\n    make : function (json) {\n\n        var wrapper = this.wrapper(),\n            siteImage = this.image(json.image, linkTool.elementClasses.image),\n            siteTitle = this.title(json.title),\n            siteDescription = this.description(json.description),\n            siteLink = this.link(json.linkUrl, json.linkText);\n\n        wrapper.appendChild(siteImage);\n        wrapper.appendChild(siteTitle);\n        wrapper.appendChild(siteLink);\n        wrapper.appendChild(siteDescription);\n\n        siteTitle.contentEditable = true;\n        siteDescription.contentEditable = true;\n\n        return wrapper;\n\n    },\n\n    mainBlock : function () {\n\n        var wrapper = document.createElement('div');\n\n        wrapper.classList += \"ceditor-tool-link\";\n\n        return wrapper;\n\n    },\n\n    input : function () {\n\n        var inputTag = document.createElement('input');\n\n        inputTag.classList += \"ceditor-tool-link-input\";\n\n        inputTag.placeholder = linkTool.defaultText;\n\n        inputTag.contentEditable = false;\n\n        return inputTag;\n\n    },\n\n    wrapper : function () {\n\n        var wrapper = document.createElement('div');\n\n        wrapper.className += 'tool-link-panel clearfix';\n\n        return wrapper;\n\n    },\n\n    image : function (imageSrc, imageClass) {\n\n        var imageTag = document.createElement('img');\n\n        imageTag.classList += imageClass;\n\n        imageTag.setAttribute('src', imageSrc);\n\n        return imageTag;\n\n    },\n\n    link : function (linkUrl, linkText) {\n\n        var linkTag = document.createElement('a');\n\n        linkTag.classList += linkTool.elementClasses.link;\n\n        linkTag.href = linkUrl;\n\n        linkTag.target = \"_blank\";\n\n        linkTag.innerText = linkText;\n\n        return linkTag;\n\n    },\n\n    title : function (titleText) {\n\n        var titleTag = document.createElement('div');\n\n        titleTag.classList.add(\"tool-link-content\", linkTool.elementClasses.title);\n\n        titleTag.innerHTML = titleText;\n\n        return titleTag;\n    },\n\n    description : function (descriptionText) {\n\n        var descriptionTag = document.createElement('div');\n\n        descriptionTag.classList.add(\"tool-link-content\", linkTool.elementClasses.description);\n\n        descriptionTag.innerHTML = descriptionText;\n\n        return descriptionTag;\n    }\n\n};\n\nmodule.exports = {\n\n    type             : 'link',\n    iconClassname    : 'ce-icon-link',\n    make             : linkTool.makeNewBlock,\n    appendCallback   : linkTool.appendCallback,\n    render           : linkTool.render,\n    save             : linkTool.save,\n    displayInToolbox : true,\n    enableLineBreaks : true\n\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./modules/plugins/link/link.js\n **/","// removed by extract-text-webpack-plugin\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./modules/plugins/link/link.css\n ** module id = 22\n ** module chunks = 0\n **/","/**\n * Code Plugin\n * Creates code tag and adds content to this tag\n *\n * @author Codex Team\n * @copyright Khaydarov Murod\n */\n\n/** Include to Build css */\nrequire('./list.css');\n\nvar codex = require('../../../editor');\nvar listTool = {\n\n    baseClass : \"tool-list\",\n    elementClasses : {\n        li  : \"tool-list-li\"\n    },\n\n    /**\n     * Make initial header block\n     * @param {object} JSON with block data\n     * @return {Element} element to append\n     */\n    make : function () {\n\n        var tag = listTool.ui.make(),\n            li  = listTool.ui.block(\"li\", \"tool-link-li\");\n\n        var br = document.createElement(\"br\");\n\n        li.appendChild(br);\n        tag.appendChild(li);\n\n        tag.classList.add('ce-list');\n\n        return tag;\n\n    },\n\n    /**\n     * Method to render HTML block from JSON\n     */\n    render : function (data) {\n\n        var type = data.type == 'ordered' ? 'OL' : 'UL',\n            tag  = listTool.ui.make(type);\n\n        tag.classList.add('ce-list');\n\n        data.items.forEach(function (element, index, array) {\n\n            var newLi = listTool.ui.block(\"li\", listTool.elementClasses.li);\n\n            newLi.innerHTML = element;\n\n            tag.dataset.type = data.type;\n            tag.appendChild(newLi);\n\n        });\n\n        return tag;\n\n    },\n\n    /**\n     * Method to extract JSON data from HTML block\n     */\n    save : function (blockContent){\n\n        var data = {\n                type  : null,\n                items : [],\n            };\n\n        for(var index = 0; index < blockContent.childNodes.length; index++)\n            data.items[index] = blockContent.childNodes[index].textContent;\n\n        data.type = blockContent.dataset.type;\n\n        return data;\n\n    },\n\n    makeSettings : function(data) {\n\n        var holder  = document.createElement('DIV'),\n            selectTypeButton;\n\n        /** Add holder classname */\n        holder.className = 'ce_plugin_list--settings';\n\n        var orderedButton = listTool.ui.button(\"ordered\"),\n            unorderedButton = listTool.ui.button(\"unordered\");\n\n        orderedButton.addEventListener('click', function (event) {\n            listTool.changeBlockStyle(event, 'ol');\n            codex.toolbar.settings.close();\n        });\n\n        unorderedButton.addEventListener('click', function (event) {\n            listTool.changeBlockStyle(event, 'ul');\n            codex.toolbar.settings.close();\n        });\n\n        holder.appendChild(orderedButton);\n        holder.appendChild(unorderedButton);\n\n        return holder;\n\n    },\n\n    changeBlockStyle : function (event, blockType) {\n\n        var currentBlock = codex.content.currentNode,\n            newEditable = listTool.ui.make(blockType),\n            oldEditable = currentBlock.querySelector(\"[contenteditable]\");\n\n            newEditable.dataset.type = blockType;\n            newEditable.innerHTML = oldEditable.innerHTML;\n            newEditable.classList.add('ce-list');\n\n            codex.content.switchBlock(currentBlock, newEditable, 'list');\n    }\n\n};\n\nlistTool.ui = {\n\n    make : function (blockType) {\n\n        var wrapper = this.block(blockType || 'UL', listTool.baseClass);\n\n        wrapper.dataset.type    = 'ul';\n        wrapper.contentEditable = true;\n\n        return wrapper;\n\n    },\n\n    block : function (blockType, blockClass) {\n\n        var block = document.createElement(blockType);\n\n        if ( blockClass ) block.classList.add(blockClass);\n\n        return block;\n\n    },\n\n    button : function (buttonType) {\n\n        var types   = {\n                unordered    : '<i class=\"ce-icon-list-bullet\"></i>Обычный список',\n                ordered      : '<i class=\"ce-icon-list-numbered\"></i>Нумерованный список'\n            },\n            button = document.createElement('SPAN');\n\n        button.innerHTML = types[buttonType];\n\n        button.className   = 'ce_plugin_list--select_button';\n\n        return button;\n    }\n};\n\n/**\n * Now plugin is ready.\n * Add it to redactor tools\n */\nmodule.exports = {\n\n    type             : 'list',\n    iconClassname    : 'ce-icon-list-bullet',\n    make             : listTool.make,\n    appendCallback   : null,\n    settings         : listTool.makeSettings(),\n    render           : listTool.render,\n    save             : listTool.save,\n    displayInToolbox : true,\n    enableLineBreaks : true\n\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./modules/plugins/list/list.js\n **/","// removed by extract-text-webpack-plugin\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./modules/plugins/list/list.css\n ** module id = 25\n ** module chunks = 0\n **/","/**\n * Quote Plugin\n *\n * @author Codex Team\n * @copyright Khaydarov Murod\n * @version 1.0.0\n */\n\n/** Include to Build css */\nrequire('./quote.css');\n\nvar codex = require('../../../editor');\nvar quoteTools = {\n\n    /** Default path to redactors images */\n    path : '/upload/redactor_images/',\n\n    /**\n    * Default quote style\n    */\n    defaultStyle : 'withPhoto',\n\n    /**\n    * Make Quote from JSON datasets\n    */\n    makeBlockToAppend : function(data) {\n\n        var tag;\n\n        if (data && data.style) {\n\n            switch (data.style) {\n                case 'simple':\n                    tag = quoteTools.makeSimpleQuote(data);\n                    break;\n                case 'withCaption':\n                    tag = quoteTools.makeQuoteWithCaption(data);\n                    break;\n                case 'withPhoto':\n                    tag = quoteTools.makeQuoteWithPhoto(data);\n                    break;\n            }\n        } else {\n\n            var settings = {\n                style  : 'withPhoto',\n                text   : '',\n                author : '',\n                job    : '',\n                photo  : ''\n            };\n\n            tag = quoteTools.makeQuoteWithPhoto(settings);\n\n        }\n\n        return tag;\n    },\n\n    render : function(data) {\n        return quoteTools.makeBlockToAppend(data);\n    },\n\n    save : function(blockContent) {\n\n        /**\n        * Extracts JSON quote data from HTML block\n        * @param {Text} text, {Text} author, {Object} photo\n        */\n        var parsedblock = quoteTools.parseBlockQuote(blockContent);\n            data = {\n                style  : parsedblock.style,\n                text   : parsedblock.text,\n                author : parsedblock.author,\n                job    : parsedblock.job,\n                photo  : parsedblock.photo,\n            };\n\n        return data;\n    },\n\n    makeSettings : function(data) {\n\n        var holder  = document.createElement('DIV'),\n            types   = {\n                        simple      : 'Простая цитата',\n                        withCaption : 'Цитата с подписью',\n                        withPhoto   : 'Цитата с фото и ФИО'\n                    },\n            selectTypeButton;\n\n        /** Add holder classname */\n        holder.className = quoteTools.styles.settings.holder;\n\n        /** Now add type selectors */\n        for (var type in types){\n\n            selectTypeButton = document.createElement('SPAN');\n\n            selectTypeButton.textContent = types[type];\n            selectTypeButton.className   = quoteTools.styles.settings.buttons;\n\n            selectTypeButton.dataset.style = type;\n\n            if ( type == quoteTools.defaultStyle ){\n                selectTypeButton.classList.add(quoteTools.styles.settings.selectedType);\n            }\n\n            // var quoteStyle = quoteTools.selectTypeQuoteStyle(type);\n\n            selectTypeButton.addEventListener('click', quoteTools.changeStyleClicked, false);\n            // quoteTools.addSelectTypeClickListener(selectTypeButton, quoteStyle);\n\n            holder.appendChild(selectTypeButton);\n\n        }\n\n        return holder;\n\n    },\n\n    changeStyleClicked : function() {\n\n        var changeStyleButton = this,\n            quote = codex.content.currentNode.querySelector('.' + quoteTools.styles.ce_quote),\n            newStyle = changeStyleButton.dataset.style,\n            styleSelectors = this.parentNode.childNodes;\n\n        quote.dataset.quoteStyle = newStyle;\n\n        /**\n        * Mark selected style button\n        */\n        for (var i = styleSelectors.length - 1; i >= 0; i--) {\n            styleSelectors[i].classList.remove(quoteTools.styles.settings.selectedType);\n        }\n\n        this.classList.add(quoteTools.styles.settings.selectedType);\n\n    },\n\n    /**\n    * @deprecated\n    */\n    selectTypeQuoteStyle : function(type) {\n\n        /**\n        *  Choose Quote style to replace\n        */\n        switch (type) {\n            case 'simple':\n                quoteStyleFunction = quoteTools.makeSimpleQuote;\n                break;\n            case 'withCaption':\n                quoteStyleFunction = quoteTools.makeQuoteWithCaption;\n                break;\n            case 'withPhoto':\n                quoteStyleFunction = quoteTools.makeQuoteWithPhoto;\n                break;\n        }\n\n        return quoteStyleFunction;\n\n    },\n\n    /**\n    * @deprecated\n    */\n    addSelectTypeClickListener : function(el, quoteStyle) {\n\n        el.addEventListener('click', function () {\n\n            /**\n            * Parsing currentNode to JSON.\n            */\n            var parsedOldQuote  = quoteTools.parseBlockQuote(),\n                newStyledQuote  = quoteStyle(parsedOldQuote);\n\n            var wrapper = codex.content.composeNewBlock(newStyledQuote, 'quote');\n                wrapper.appendChild(newStyledQuote);\n\n            codex.content.switchBlock(codex.content.currentNode, newStyledQuote, 'quote');\n\n            /** Close settings after replacing */\n            codex.toolbar.settings.close();\n\n        }, false);\n\n    },\n\n    /**\n    * @deprecated\n    */\n    makeSimpleQuote : function(data) {\n\n        var wrapper = quoteTools.ui.makeBlock('BLOCKQUOTE', [quoteTools.styles.simple.text, quoteTools.styles.quoteText]);\n\n        wrapper.innerHTML = data.text || '';\n\n        wrapper.dataset.quoteStyle = 'simple';\n        wrapper.classList.add(quoteTools.styles.ce_quote);\n        wrapper.contentEditable = 'true';\n\n        return wrapper;\n    },\n\n    /**\n    * @deprecated\n    */\n    makeQuoteWithCaption : function(data) {\n\n        var wrapper = quoteTools.ui.blockquote(),\n            text    = quoteTools.ui.makeBlock('DIV', [quoteTools.styles.withCaption.blockquote, quoteTools.styles.quoteText]),\n            author  = quoteTools.ui.makeBlock('DIV', [quoteTools.styles.withCaption.author, quoteTools.styles.quoteAuthor]);\n\n            /* make text block ontentEditable */\n            text.contentEditable = 'true';\n\n            text.innerHTML = data.text;\n\n            /* make Author contentEditable */\n            author.contentEditable = 'true';\n\n            author.textContent = data.author;\n\n        /* Appending created components */\n        wrapper.dataset.quoteStyle = 'withCaption';\n        wrapper.classList.add(quoteTools.styles.ce_quote);\n\n        wrapper.appendChild(text);\n        wrapper.appendChild(author);\n\n        return wrapper;\n\n    },\n\n    makeQuoteWithPhoto : function(data) {\n\n        var wrapper  = quoteTools.ui.blockquote(),\n            photo    = quoteTools.ui.makeBlock('DIV', [quoteTools.styles.withPhoto.photo]),\n            author   = quoteTools.ui.makeBlock('DIV', [quoteTools.styles.withPhoto.author, quoteTools.styles.quoteAuthor]),\n            job      = quoteTools.ui.makeBlock('DIV', [quoteTools.styles.withPhoto.job, quoteTools.styles.authorsJob]),\n            quote    = quoteTools.ui.makeBlock('DIV', [quoteTools.styles.withPhoto.quote, quoteTools.styles.quoteText]);\n\n            /* Default Image src */\n            if (!data.photo) {\n\n                var icon = quoteTools.ui.makeBlock('SPAN', ['ce-icon-picture']);\n                photo.appendChild(icon);\n\n            } else {\n\n                var authorsPhoto = quoteTools.ui.img(quoteTools.styles.authorsPhoto);\n                authorsPhoto.src = data.photo;\n\n                photo.classList.add(quoteTools.styles.authorsPhotoWrapper);\n                photo.appendChild(authorsPhoto);\n            }\n\n\n            photo.addEventListener('click', quoteTools.fileUploadClicked, false);\n\n            /* make author block contentEditable */\n            author.contentEditable = 'true';\n            author.textContent = data.author;\n\n            /*  Author's position and job */\n            job.contentEditable = 'true';\n            job.textContent = data.job;\n\n        var authorsWrapper = quoteTools.ui.makeBlock('DIV', [quoteTools.styles.withPhoto.authorHolder]);\n            authorsWrapper.appendChild(author);\n            authorsWrapper.appendChild(job);\n\n            /* make quote text contentEditable */\n            quote.contentEditable = 'true';\n            quote.innerHTML = data.text;\n\n        wrapper.classList.add(quoteTools.styles.ce_quote);\n        wrapper.classList.add(quoteTools.styles.withPhoto.wrapper);\n        wrapper.dataset.quoteStyle = 'withPhoto';\n\n        wrapper.appendChild(quote);\n        wrapper.appendChild(photo);\n        wrapper.appendChild(authorsWrapper);\n\n        return wrapper;\n    },\n\n    parseBlockQuote : function(block) {\n\n        var currentNode = block || codex.content.currentNode,\n            photo       = currentNode.getElementsByTagName('img')[0],\n            author      = currentNode.querySelector('.' + quoteTools.styles.quoteAuthor),\n            job         = currentNode.querySelector('.' + quoteTools.styles.authorsJob),\n            quote ;\n\n        /** Simple quote text placed in Blockquote tag*/\n        if ( currentNode.dataset.quoteStyle == 'simple' )\n            quote = currentNode.innerHTML;\n        else\n            quote = currentNode.querySelector('.' + quoteTools.styles.quoteText).innerHTML;\n\n        if (job)\n            job = job.textContent;\n\n        if (author)\n            author = author.textContent;\n\n        if (photo)\n            photo = photo.src;\n\n        var data = {\n            style       : currentNode.dataset.quoteStyle,\n            text        : quote,\n            author      : author,\n            job         : job,\n            photo       : photo,\n        };\n\n        return data;\n    },\n\n    fileUploadClicked : function() {\n\n        var success = quoteTools.photoUploadingCallbacks.success,\n            error   = quoteTools.photoUploadingCallbacks.error;\n\n        codex.transport.selectAndUpload({\n            success,\n            error,\n        });\n\n    }\n\n};\n\nquoteTools.styles = {\n\n    ce_quote     : 'ce-quote',\n    quoteText    : 'ce_quote--text',\n    quoteAuthor  : 'ce_quote--author',\n    authorsJob   : 'ce_quote--job',\n    authorsPhoto : 'authorsPhoto',\n    authorsPhotoWrapper : 'authorsPhoto-wrapper',\n\n    simple : {\n        text : 'quoteStyle-simple--text',\n    },\n\n    withCaption : {\n        blockquote : 'quoteStyle-withCaption--blockquote',\n        author     : 'quoteStyle-withCaption--author',\n    },\n\n    withPhoto : {\n        photo   : 'quoteStyle-withPhoto--photo',\n        author  : 'quoteStyle-withPhoto--author',\n        job     : 'quoteStyle-withPhoto--job',\n        quote   : 'quoteStyle-withPhoto--quote',\n        wrapper : 'quoteStyle-withPhoto--wrapper',\n        authorHolder : 'quoteStyle-withPhoto--authorWrapper',\n    },\n\n    settings  : {\n        holder  : 'ce_plugin_quote--settings',\n        caption : 'ce_plugin_quote--caption',\n        buttons : 'ce_plugin_quote--select_button',\n        selectedType : 'ce-quote-settings--selected'\n    },\n};\n\nquoteTools.ui = {\n\n    wrapper : function($classList) {\n\n        var el = document.createElement('DIV');\n\n        el.classList.add($classList);\n\n        return el;\n\n    },\n\n    blockquote : function() {\n\n        var el = document.createElement('BLOCKQUOTE');\n\n        return el;\n\n    },\n\n    img : function(attribute) {\n        var imageTag = document.createElement('IMG');\n        imageTag.classList.add(attribute);\n\n        return imageTag;\n    },\n\n    makeBlock : function(tag, classList) {\n\n        var el = document.createElement(tag);\n\n\n        if ( classList ) {\n\n            for( var i = 0; i < classList.length; i++)\n                el.className += ' ' + classList[i];\n\n        }\n        return el;\n\n    }\n\n};\n\nquoteTools.photoUploadingCallbacks = {\n\n    /**\n    * Success callbacks for uploaded photo.\n    * Replace upload icon with uploaded photo\n    */\n    success : function(result) {\n\n        var parsed   = JSON.parse(result),\n            filename = parsed.filename,\n            uploadImageWrapper = codex.content.currentNode.querySelector('.' + quoteTools.styles.withPhoto.photo),\n            authorsPhoto = quoteTools.ui.img(quoteTools.styles.authorsPhoto);\n\n        authorsPhoto.src = quoteTools.path + 'b_' + filename;\n\n        /** Remove icon from image wrapper */\n        uploadImageWrapper.innerHTML = '';\n\n        /** Appending uploaded image */\n        uploadImageWrapper.classList.add(quoteTools.styles.authorsPhotoWrapper);\n        uploadImageWrapper.appendChild(authorsPhoto);\n    },\n\n    /** Error callback. Sends notification to user that something happend or plugin doesn't supports method */\n    error : function(result) {\n\n        console.log('Can\\'t upload an image');\n        codex.notifications.errorThrown();\n\n    }\n\n};\n\nmodule.exports = {\n\n    type             : 'quote',\n    iconClassname    : 'ce-icon-quote',\n    make             : quoteTools.makeBlockToAppend,\n    appendCallback   : null,\n    settings         : quoteTools.makeSettings(),\n    render           : quoteTools.render,\n    save             : quoteTools.save,\n    displayInToolbox : true,\n    enableLineBreaks : true,\n    allowedToPaste   : true\n\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./modules/plugins/quote/quote.js\n **/","// removed by extract-text-webpack-plugin\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./modules/plugins/quote/quote.css\n ** module id = 28\n ** module chunks = 0\n **/","/**\n * Image plugin for codex-editor\n * @author CodeX Team <team@ifmo.su>\n * @copyright Khaydarov Murod\n *\n * @version 1.1.3\n */\n\n/** Include to Build css */\nrequire('./image.css');\n\nvar codex = require('../../../editor');\nvar ceImage = {\n\n    elementClasses : {\n\n        ce_image      : 'ce-image',\n        loading       : 'ce-plugin-image__loader',\n        blockStretched: 'ce-block--stretched',\n        uploadedImage : {\n                centered  : 'ce-plugin-image__uploaded--centered',\n                stretched : 'ce-plugin-image__uploaded--stretched',\n        },\n        imageCaption  : 'ce-plugin-image__caption',\n        imageWrapper  : 'ce-plugin-image__wrapper',\n        formHolder    : 'ce-plugin-image__holder',\n        uploadButton  : 'ce-plugin-image__button',\n\n    },\n\n    holder : null,\n\n    /** Default path to redactors images */\n    path : '/upload/redactor_images/',\n\n    make : function ( data ) {\n\n        var holder;\n\n        if (data) {\n\n            if ( data.isStretch !== 'true') {\n                holder = ceImage.ui.makeImage(data, ceImage.elementClasses.uploadedImage.centered, 'false');\n            } else {\n                holder = ceImage.ui.makeImage(data, ceImage.elementClasses.uploadedImage.stretched, 'true');\n            }\n\n            return holder;\n\n        } else {\n\n            holder = ceImage.ui.makeForm();\n\n            return holder;\n        }\n    },\n\n    /**\n     * this tool works when tool is clicked in toolbox\n     */\n    appendCallback : function(event) {\n\n        /** Upload image and call success callback*/\n        ceImage.uploadButtonClicked(event);\n\n    },\n\n    /**\n    * Settings panel content\n    * @return {Element} element contains all settings\n    */\n    makeSettings : function () {\n\n        var holder  = document.createElement('DIV'),\n            types   = {\n                        centered  : 'По центру',\n                        stretched : 'На всю ширину',\n                    },\n            selectTypeButton;\n\n        /** Add holder classname */\n        holder.className = 'ce_plugin_image--settings';\n\n        /** Now add type selectors */\n        for (var type in types){\n\n            selectTypeButton = document.createElement('SPAN');\n\n            selectTypeButton.textContent = types[type];\n            selectTypeButton.className   = 'ce_plugin_image--select_button';\n\n            this.addSelectTypeClickListener(selectTypeButton, type);\n\n            holder.appendChild(selectTypeButton);\n\n        }\n\n        return holder;\n\n    },\n\n    addSelectTypeClickListener : function(el, type) {\n\n        el.addEventListener('click', function() {\n\n            ceImage.selectTypeClicked(type);\n\n        }, false);\n\n    },\n\n    selectTypeClicked : function(type) {\n\n        var current      = codex.content.currentNode,\n            blockContent = current.childNodes[0],\n            image   = ceImage.ui.getImage(current),\n            wrapper = current.querySelector('.' + ceImage.elementClasses.imageWrapper);\n\n        /** Clear classList */\n        current.className = '';\n        image.className   = '';\n\n        /** Add important first-level class ce_block */\n        current.classList.add(codex.ui.className.BLOCK_CLASSNAME);\n\n        if (type === 'stretched') {\n\n            image.classList.add(ceImage.elementClasses.uploadedImage.stretched);\n\n            blockContent.classList.add(ceImage.elementClasses.blockStretched);\n\n            /** Setting dataset for saver */\n            wrapper.dataset.stretched = true;\n\n        } else if (type === 'centered') {\n\n            image.classList.add(ceImage.elementClasses.uploadedImage.centered);\n\n            blockContent.classList.remove(ceImage.elementClasses.blockStretched);\n\n            /** Setting dataset for saver */\n            wrapper.dataset.stretched = false;\n        }\n    },\n\n    render : function( data ) {\n\n        return this.make(data);\n    },\n\n    save : function ( block ) {\n\n        var content    = block,\n            image   = ceImage.ui.getImage(content),\n            caption = content.querySelector('.' + ceImage.elementClasses.imageCaption);\n\n        var data = {\n            background : false,\n            border : false,\n            isStretch : content.dataset.stretched,\n            file : {\n                url : image.src,\n                bigUrl : null,\n                width  : image.width,\n                height : image.height,\n                additionalData :null,\n            },\n            caption : caption.textContent,\n            cover : null,\n        };\n\n        return data;\n    },\n\n    uploadButtonClicked : function(event) {\n\n        var beforeSend = ceImage.photoUploadingCallbacks.beforeSend,\n            success    = ceImage.photoUploadingCallbacks.success,\n            error      = ceImage.photoUploadingCallbacks.error;\n\n        /** Define callbacks */\n        codex.transport.selectAndUpload({\n            beforeSend,\n            success,\n            error,\n        });\n    },\n\n};\n\nceImage.ui = {\n\n    holder : function(){\n\n        var element = document.createElement('DIV');\n\n        element.classList.add(ceImage.elementClasses.formHolder);\n        element.classList.add(ceImage.elementClasses.ce_image);\n\n        return element;\n    },\n\n    uploadButton : function(){\n\n        var button = document.createElement('SPAN');\n\n        button.classList.add(ceImage.elementClasses.uploadButton);\n\n        button.innerHTML = '<i class=\"ce-icon-picture\"> </i>';\n        button.innerHTML += 'Загрузить фотографию';\n\n        return button;\n\n    },\n\n    /**\n    * @param {string} source - file path\n    * @param {string} style - css class\n    * @return {object} image - document IMG tag\n    */\n    image : function(source, style) {\n\n        var image = document.createElement('IMG');\n\n        image.classList.add(style);\n\n        image.src = source;\n\n        return image;\n    },\n\n    wrapper : function() {\n\n        var div = document.createElement('div');\n\n        div.classList.add(ceImage.elementClasses.imageWrapper);\n\n        return div;\n    },\n\n    caption : function() {\n\n        var div  = document.createElement('div');\n\n        div.classList.add(ceImage.elementClasses.imageCaption);\n        div.contentEditable = true;\n\n        return div;\n    },\n    /**\n    * Draws form for image upload\n    */\n    makeForm : function() {\n\n        var holder       = ceImage.ui.holder(),\n            uploadButton = ceImage.ui.uploadButton();\n\n        holder.appendChild(uploadButton);\n\n        uploadButton.addEventListener('click', ceImage.uploadButtonClicked, false );\n\n        ceImage.holder = holder;\n\n        return holder;\n    },\n\n\n    /**\n    * wraps image and caption\n    * @param {object} data - image information\n    * @param {string} imageTypeClass - plugin's style\n    * @param {boolean} stretched - stretched or not\n    * @return wrapped block with image and caption\n    */\n    makeImage : function(data, imageTypeClass, stretched) {\n\n        var file = data.file.url,\n            text = data.caption,\n            type     = data.type,\n            image    = ceImage.ui.image(file, imageTypeClass),\n            caption  = ceImage.ui.caption(),\n            wrapper  = ceImage.ui.wrapper();\n\n        caption.textContent = text;\n\n        wrapper.dataset.stretched = stretched;\n        /** Appeding to the wrapper */\n        wrapper.appendChild(image);\n        wrapper.appendChild(caption);\n\n        return wrapper;\n    },\n\n    /**\n    * @param {HTML} data - Rendered block with image\n    */\n    getImage : function(data) {\n\n        var image = data.querySelector('.' + ceImage.elementClasses.uploadedImage.centered) ||\n                    data.querySelector('.' + ceImage.elementClasses.uploadedImage.stretched);\n\n        return image;\n    },\n\n    /**\n    * wraps image and caption\n    * @deprecated\n    * @param {object} data - image information\n    * @return wrapped block with image and caption\n    */\n    centeredImage : function(data) {\n\n        var file = data.file.url,\n            text = data.caption,\n            type     = data.type,\n            image    = ceImage.ui.image(file, ceImage.elementClasses.uploadedImage.centered),\n            caption  = ceImage.ui.caption(),\n            wrapper  = ceImage.ui.wrapper();\n\n        caption.textContent = text;\n\n        wrapper.dataset.stretched = 'false';\n\n        /** Appeding to the wrapper */\n        wrapper.appendChild(image);\n        wrapper.appendChild(caption);\n\n        return wrapper;\n    },\n\n    /**\n    * wraps image and caption\n    * @deprecated\n    * @param {object} data - image information\n    * @return stretched image\n    */\n    stretchedImage : function(data) {\n\n        var file = data.file.url,\n            text = data.caption,\n            type     = data.type,\n            image    = ceImage.ui.image(file, ceImage.elementClasses.uploadedImage.stretched),\n            caption  = ceImage.ui.caption(),\n            wrapper  = ceImage.ui.wrapper();\n\n        caption.textContent = text;\n\n        wrapper.dataset.stretched = 'true';\n        /** Appeding to the wrapper */\n        wrapper.appendChild(image);\n        wrapper.appendChild(caption);\n\n        return wrapper;\n\n    }\n\n};\n\nceImage.photoUploadingCallbacks = {\n\n    /** Before sending ajax request */\n    beforeSend : function() {\n        ceImage.holder.classList.add(ceImage.elementClasses.loading);\n    },\n\n    /** Photo was uploaded successfully */\n    success : function(result) {\n\n        var parsed = JSON.parse(result),\n            data,\n            currentBlock = codex.content.currentNode,\n            image;\n\n        /**\n        * Preparing {Object} data to draw an image\n        * @uses ceImage.make method\n        */\n        data = {\n            background : false,\n            border   : false,\n            isStretch : false,\n            file : {\n                url    : ceImage.path + 'o_' + parsed.filename,\n                bigUrl : null,\n                width  : null,\n                height : null,\n                additionalData : null,\n            },\n            caption : '',\n            cover : null,\n        };\n\n        image = ceImage.make(data);\n\n        /**\n         * If current block is empty, we can replace it to uploaded image\n         * Or insert new block\n         */\n        codex.content.switchBlock(ceImage.holder, image, 'image');\n    },\n\n    /** Error callback. Sends notification to user that something happend or plugin doesn't supports method */\n    error : function(result) {\n        console.log('Choosen file is not an image or image is corrupted');\n        codex.notifications.errorThrown();\n    },\n\n};\n\n\n/**\n* Add plugin it to redactor tools\n*/\nmodule.exports = {\n\n    type             : 'image',\n    iconClassname    : 'ce-icon-picture',\n    make             : ceImage.make,\n    appendCallback   : ceImage.appendCallback,\n    settings         : ceImage.makeSettings(),\n    render           : ceImage.render,\n    save             : ceImage.save,\n    isStretched      : true,\n    displayInToolbox : true,\n    enableLineBreaks : false\n\n};\n\n\n/** WEBPACK FOOTER **\n ** ./modules/plugins/image/image.js\n **/","// removed by extract-text-webpack-plugin\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./modules/plugins/image/image.css\n ** module id = 31\n ** module chunks = 0\n **/","/**\n * Instagram plugin\n * Renders url to Instagram Embed\n *\n * @author Codex Team\n * @copyright Khaydarov Murod\n *\n * @version 1.0.0\n */\n\n/** Include to Build css */\nrequire('./instagram.css');\n\nvar codex = require('../../../editor');\nvar instagramTool = {\n\n    /**\n     * Prepare before usage\n     * Load important scripts to render embed\n     */\n    prepare : function() {\n\n        var script = \"//platform.instagram.com/en_US/embeds.js\";\n\n        /**\n         * Load widget\n         */\n        codex.core.importScript(script, 'instagramAPI');\n    },\n\n    /**\n     * Make instagram embed via Widgets method\n     */\n    make : function(data) {\n\n        if (!data.url)\n            return;\n\n\n        var block = instagramTool.content.instagramBlock(data.url);\n        instagramTool.content.render(block);\n    },\n\n    /**\n     * Saving JSON output.\n     * Upload data via ajax\n     */\n    save : function(blockContent) {\n\n        var data;\n\n        /** Example */\n        data = {\n            media:true,\n            conversation:false,\n            user:{\n            },\n            url: blockContent.src\n        };\n\n        return data;\n\n    },\n\n    /**\n     * Render data\n     */\n    render : function(data) {\n        return instagramTool.make(data);\n    }\n\n};\n\ninstagramTool.content = {\n\n    render : function(content) {\n\n        codex.content.switchBlock(codex.content.currentNode, content, 'instagram');\n\n        var blockContent = codex.content.currentNode.childNodes[0];\n        blockContent.classList.add('ce-redactor__loader');\n\n        window.instgrm.Embeds.process();\n\n        setTimeout(function(){\n            blockContent.classList.remove('ce-redactor__loader');\n        }, 500);\n    },\n\n    /**\n     * Drawing html content.\n     *\n     * @param url\n     * @returns {Element} blockquote - HTML template for Instagram Embed JS\n     */\n    instagramBlock : function(url) {\n\n        var blockquote = codex.draw.node('BLOCKQUOTE', 'instagram-media instagram', {}),\n            div        = codex.draw.node('DIV', '', {}),\n            paragraph  = codex.draw.node('P', 'ce-paste__instagram--p', {}),\n            anchor     = codex.draw.node('A', '', { href : url });\n\n        blockquote.dataset.instgrmVersion = 4;\n\n        paragraph.appendChild(anchor);\n        div.appendChild(paragraph);\n        blockquote.appendChild(div);\n\n        return blockquote;\n\n    },\n\n};\n\nmodule.exports = {\n\n    type             : 'instagram',\n    iconClassname    : 'ce-icon-instagram',\n    prepare          : instagramTool.prepare,\n    make             : instagramTool.make,\n    appendCallback   : null,\n    settings         : null,\n    render           : instagramTool.reneder,\n    save             : instagramTool.save,\n    displayInToolbox : false,\n    enableLineBreaks : false,\n    allowedToPaste   : false\n\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./modules/plugins/instagram/instagram.js\n **/","// removed by extract-text-webpack-plugin\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./modules/plugins/instagram/instagram.css\n ** module id = 34\n ** module chunks = 0\n **/","/**\n * Twitter plugin\n *\n * @author Codex Team\n * @copyright Khaydarov Murod\n * @version 1.0.0\n */\n\n/** Include to Build css */\nrequire('./twitter.css');\n\n\nvar codex = require('../../../editor');\nvar twitterTool = {\n\n    /**\n     * Prepare twitter scripts\n     */\n    prepare : function() {\n\n        var script = \"//platform.twitter.com/widgets.js\";\n\n        /**\n         * Load script\n         */\n        codex.core.importScript(script, 'twitterAPI');\n\n    },\n\n    make : function(data) {\n\n        if (!data.id)\n            return;\n\n        twitterTool.content.twitter(data.id);\n    },\n\n    save : function(blockContent) {\n\n        var data;\n\n        data = {\n            media:true,\n            conversation:false,\n            user:{\n                profile_image_url:\"http:\\/\\/pbs.twimg.com\\/profile_images\\/1817165982\\/nikita-likhachev-512_normal.jpg\",\n                profile_image_url_https:\"https:\\/\\/pbs.twimg.com\\/profile_images\\/1817165982\\/nikita-likhachev-512_normal.jpg\",\n                screen_name:\"Niketas\",\n                name:\"Никита Лихачёв\"\n            },\n            id: blockContent.dataset.tweetId,\n            text:\"ВНИМАНИЕ ЧИТАТЬ ВСЕМ НЕ ДАЙ БОГ ПРОПУСТИТЕ НУ ИЛИ ХОТЯ БЫ КЛИКНИ И ПОДОЖДИ 15 СЕКУНД https:\\/\\/t.co\\/iWyOHf4xr2\",\n            created_at:\"Tue Jun 28 14:09:12 +0000 2016\",\n            status_url:\"https:\\/\\/twitter.com\\/Niketas\\/status\\/747793978511101953\",\n            caption:\"Caption\"\n        };\n\n        return data;\n\n    },\n\n    render : function(data) {\n        return twitterTool.make(data);\n    }\n\n};\n\ntwitterTool.content = {\n\n    /**\n     * Twitter render method appends content after block\n     * @param tweetId\n     */\n    twitter : function(tweetId) {\n\n        var tweet = twitterTool.content.twitterBlock();\n\n        codex.content.switchBlock(codex.content.currentNode, tweet, 'twitter');\n\n        var blockContent = codex.content.currentNode.childNodes[0];\n        blockContent.classList.add('ce-redactor__loader');\n\n        window.twttr.widgets.createTweet(tweetId, blockContent);\n\n        setTimeout(function() {\n            blockContent.classList.remove('ce-redactor__loader');\n        }, 500);\n\n        /** Remove empty DIV */\n        blockContent.childNodes[0].remove();\n\n    },\n\n    twitterBlock : function() {\n        var block = codex.draw.node('DIV', '', {});\n        return block;\n    }\n};\n\nmodule.exports = {\n\n    type             : 'twitter',\n    iconClassname    : 'ce-icon-twitter',\n    prepare          : twitterTool.prepare,\n    make             : twitterTool.make,\n    appendCallback   : null,\n    settings         : null,\n    render           : twitterTool.render,\n    save             : twitterTool.save,\n    displayInToolbox : false,\n    enableLineBreaks : false,\n    allowedToPaste   : false\n\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./modules/plugins/twitter/twitter.js\n **/","// removed by extract-text-webpack-plugin\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./modules/plugins/twitter/twitter.css\n ** module id = 37\n ** module chunks = 0\n **/","/**\n * Paste plugin.\n *\n * Listens on paste event and pastes content from:\n *  - Instagram\n *  - Twitter\n *  - VK\n *  - Facebook\n *  - Image\n *  - External Link\n *\n * @author Codex Team\n * @copyright Khaydarov Murod\n *\n * @version 1.0.0\n */\n\n/** Include to Build css */\nrequire('./paste.css');\n\nvar codex = require('../../../editor');\n\n/**\n * @protected\n *\n * Main tool settings.\n */\nvar pasteTool = {\n\n};\n\n/**\n * Make elements to insert or switch\n *\n * @uses Core codex.draw module\n */\npasteTool.ui = {\n\n    /**\n     * Upload image by URL\n     *\n     * @uses codex Image tool\n     * @param filename\n     * @returns {Element}\n     */\n    uploadedImage : function(filename) {\n\n        var data = {\n            background: false,\n            border: false,\n            isStretch: false,\n            file: {\n                url: \"upload/redactor_images/\" + filename,\n                bigUrl: \"upload/redactor_images/\" + filename,\n                width: null,\n                height: null,\n                additionalData: \"null\"\n            },\n            caption: '',\n            cover: null\n        };\n\n        /** Using Image plugin make method */\n        var image = codex.tools.image.make(data);\n\n        return image;\n\n    }\n\n};\n\n\n/**\n *\n * Callbacks\n */\npasteTool.callbacks = {\n\n    /**\n     * Saves data\n     * @param event\n     */\n    pasted : function(event) {\n\n        var clipBoardData = event.clipboardData || window.clipboardData,\n            content = clipBoardData.getData('Text');\n\n        pasteTool.callbacks.analize(content);\n    },\n\n    /**\n     * Analizes pated string and calls necessary method\n     */\n    analize : function(string) {\n\n        var regexTemplates = {\n                image : /(?:([^:\\/?#]+):)?(?:\\/\\/([^\\/?#]*))?([^?#]*\\.(?:jpe?g|gif|png))(?:\\?([^#]*))?(?:#(.*))?/i,\n                instagram : new RegExp(\"http?.+instagram.com\\/p?.\"),\n                twitter : new RegExp(\"http?.+twitter.com?.+\\/\"),\n                facebook : /https?.+facebook.+\\/\\d+\\?/,\n                vk : /https?.+vk?.com\\/feed\\?w=wall\\d+_\\d+/,\n            },\n\n            image  = regexTemplates.image.test(string),\n            instagram = regexTemplates.instagram.exec(string),\n            twitter = regexTemplates.twitter.exec(string),\n            facebook = regexTemplates.facebook.test(string),\n            vk = regexTemplates.vk.test(string);\n\n        if (image) {\n\n            pasteTool.callbacks.uploadImage(string);\n\n        } else if (instagram) {\n\n            pasteTool.callbacks.instagramMedia(instagram);\n\n        } else if (twitter) {\n\n            pasteTool.callbacks.twitterMedia(twitter);\n\n        } else if (facebook) {\n\n            pasteTool.callbacks.facebookMedia(string);\n\n        } else if (vk) {\n\n            pasteTool.callbacks.vkMedia(string);\n\n        }\n\n    },\n\n    /**\n     * Direct upload\n     * @param url\n     */\n    uploadImage : function(path) {\n\n        var ajaxUrl = location.protocol + '//' + location.hostname,\n            file,\n            image,\n            current = codex.content.currentNode,\n            beforeSend,\n            success_callback;\n\n        /** When image is uploaded to redactors folder */\n        success_callback = function(data) {\n\n            var file = JSON.parse(data);\n            image = pasteTool.ui.uploadedImage(file.filename);\n            codex.content.switchBlock(current, image, 'image');\n\n        };\n\n        /** Before sending XMLHTTP request */\n        beforeSend = function() {\n            var content = current.querySelector('.ce-block__content');\n            content.classList.add('ce-plugin-image__loader');\n        };\n\n        /** Preparing data for XMLHTTP */\n        var data = {\n            url: ajaxUrl + '/editor/transport/',\n            type: \"POST\",\n            data : {\n                file: path\n            },\n            beforeSend : beforeSend,\n            success : success_callback\n        };\n\n        codex.core.ajax(data);\n    },\n\n    /**\n     * callback for instagram url's\n     * Using instagram Embed Widgete to render\n     * @uses Instagram tool\n     * @param url\n     */\n    instagramMedia : function(url) {\n\n        var fullUrl = url.input,\n            data;\n\n\n        data = {\n            url: fullUrl\n        };\n\n        codex.tools.instagram.make(data);\n\n    },\n\n    /**\n     * callback for tweets\n     * Using Twittter Widget to render\n     * @uses Twitter tool\n     * @param url\n     */\n    twitterMedia : function(url) {\n\n        var fullUrl = url.input,\n            tweetId,\n            arr,\n            data;\n\n        arr = fullUrl.split('/');\n        tweetId = arr.pop();\n\n        /** Example */\n        data = {\n            media:true,\n            conversation:false,\n            user:{\n                profile_image_url:\"http:\\/\\/pbs.twimg.com\\/profile_images\\/1817165982\\/nikita-likhachev-512_normal.jpg\",\n                profile_image_url_https:\"https:\\/\\/pbs.twimg.com\\/profile_images\\/1817165982\\/nikita-likhachev-512_normal.jpg\",\n                screen_name:\"Niketas\",\n                name:\"Никита Лихачёв\"\n            },\n            id: tweetId,\n            text:\"ВНИМАНИЕ ЧИТАТЬ ВСЕМ НЕ ДАЙ БОГ ПРОПУСТИТЕ НУ ИЛИ ХОТЯ БЫ КЛИКНИ И ПОДОЖДИ 15 СЕКУНД https:\\/\\/t.co\\/iWyOHf4xr2\",\n            created_at:\"Tue Jun 28 14:09:12 +0000 2016\",\n            status_url:\"https:\\/\\/twitter.com\\/Niketas\\/status\\/747793978511101953\",\n            caption:\"Caption\"\n        };\n\n        codex.tools.twitter.make(data);\n    }\n\n};\n\nmodule.exports = {\n\n    type             : 'paste',\n    iconClassname    : '',\n    prepare          : pasteTool.prepare,\n    make             : pasteTool.make,\n    appendCallback   : null,\n    settings         : null,\n    render           : null,\n    save             : pasteTool.save,\n    displayInToolbox : false,\n    enableLineBreaks : false,\n    callbacks        : pasteTool.callbacks,\n    allowedToPaste   : false\n\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./modules/plugins/paste/paste.js\n **/","// removed by extract-text-webpack-plugin\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./modules/plugins/paste/paste.css\n ** module id = 40\n ** module chunks = 0\n **/","var codex = require('../editor');\n\nvar callbacks = (function(callbacks) {\n\n    callbacks.redactorSyncTimeout = null;\n\n    callbacks.globalKeydown = function(event){\n        switch (event.keyCode){\n            case codex.core.keys.TAB   : codex.callback.tabKeyPressed(event);       break;\n            case codex.core.keys.ENTER : codex.callback.enterKeyPressed(event);     break;\n            case codex.core.keys.ESC   : codex.callback.escapeKeyPressed(event);    break;\n            default                      : codex.callback.defaultKeyPressed(event);    break;\n        }\n    };\n\n    callbacks.globalKeyup = function(event){\n        switch (event.keyCode){\n            case codex.core.keys.UP    :\n            case codex.core.keys.LEFT  :\n            case codex.core.keys.RIGHT :\n            case codex.core.keys.DOWN  : codex.callback.arrowKeyPressed(event); break;\n        }\n    };\n\n    callbacks.tabKeyPressed = function(event){\n\n        if ( !codex.toolbar.opened ) {\n            codex.toolbar.open();\n        }\n\n        if (codex.toolbar.opened && !codex.toolbar.toolbox.opened) {\n            codex.toolbar.toolbox.open();\n        } else {\n            codex.toolbar.toolbox.leaf();\n        }\n\n        event.preventDefault();\n    };\n\n    /**\n     * ENTER key handler\n     * Makes new paragraph block\n     */\n    callbacks.enterKeyPressed = function(event){\n\n        /** Set current node */\n        var firstLevelBlocksArea = codex.callback.clickedOnFirstLevelBlockArea();\n\n        if (firstLevelBlocksArea) {\n            event.preventDefault();\n\n            /**\n             * it means that we lose input index, saved index before is not correct\n             * therefore we need to set caret when we insert new block\n             */\n            codex.caret.inputIndex = -1;\n\n            codex.callback.enterPressedOnBlock();\n            return;\n        }\n\n        if (event.target.contentEditable == 'true') {\n\n            /** Update input index */\n            codex.caret.saveCurrentInputIndex();\n        }\n\n        if (!codex.content.currentNode) {\n            /**\n             * Enter key pressed in first-level block area\n             */\n            codex.callback.enterPressedOnBlock(event);\n            return;\n        }\n\n\n        var currentInputIndex       = codex.caret.getCurrentInputIndex() || 0,\n            workingNode             = codex.content.currentNode,\n            tool                    = workingNode.dataset.tool,\n            isEnterPressedOnToolbar = codex.toolbar.opened &&\n                codex.toolbar.current &&\n                event.target == codex.state.inputs[currentInputIndex];\n\n        /** The list of tools which needs the default browser behaviour */\n        var enableLineBreaks = codex.tools[tool].enableLineBreaks;\n\n        /** This type of block creates when enter is pressed */\n        var NEW_BLOCK_TYPE = 'paragraph';\n\n        /**\n         * When toolbar is opened, select tool instead of making new paragraph\n         */\n        if ( isEnterPressedOnToolbar ) {\n\n            event.preventDefault();\n\n            codex.toolbar.toolbox.toolClicked(event);\n\n            codex.toolbar.close();\n\n            return;\n\n        }\n\n        /**\n         * Allow making new <p> in same block by SHIFT+ENTER and forbids to prevent default browser behaviour\n         */\n        if ( event.shiftKey && !enableLineBreaks) {\n            codex.callback.enterPressedOnBlock(codex.content.currentBlock, event);\n            event.preventDefault();\n\n        } else if ( (event.shiftKey && !enableLineBreaks) || (!event.shiftKey && enableLineBreaks) ){\n            /** XOR */\n            return;\n        }\n\n        var isLastTextNode = false,\n            currentSelection = window.getSelection(),\n            currentSelectedNode = currentSelection.anchorNode,\n            caretAtTheEndOfText = codex.caret.position.atTheEnd(),\n            isTextNodeHasParentBetweenContenteditable = false;\n\n        /**\n         * Workaround situation when caret at the Text node that has some wrapper Elements\n         * Split block cant handle this.\n         * We need to save default behavior\n         */\n        isTextNodeHasParentBetweenContenteditable = currentSelectedNode && currentSelectedNode.parentNode.contentEditable != \"true\";\n\n        /**\n         * Split blocks when input has several nodes and caret placed in textNode\n         */\n        if (\n            currentSelectedNode.nodeType == codex.core.nodeTypes.TEXT &&\n            !isTextNodeHasParentBetweenContenteditable &&\n            !caretAtTheEndOfText\n        ){\n\n            event.preventDefault();\n\n            codex.core.log('Splitting Text node...');\n\n            codex.content.splitBlock(currentInputIndex);\n\n            /** Show plus button when next input after split is empty*/\n            if (!codex.state.inputs[currentInputIndex + 1].textContent.trim()) {\n                codex.toolbar.showPlusButton();\n            }\n\n        } else {\n\n            if ( currentSelectedNode && currentSelectedNode.parentNode) {\n\n                isLastTextNode = !currentSelectedNode.parentNode.nextSibling;\n\n            }\n\n            if ( isLastTextNode && caretAtTheEndOfText ) {\n\n                event.preventDefault();\n\n                codex.core.log('ENTER clicked in last textNode. Create new BLOCK');\n\n                codex.content.insertBlock({\n                    type  : NEW_BLOCK_TYPE,\n                    block : codex.tools[NEW_BLOCK_TYPE].render()\n                }, true );\n\n                codex.toolbar.move();\n                codex.toolbar.open();\n\n                /** Show plus button with empty block */\n                codex.toolbar.showPlusButton();\n\n            } else {\n\n                codex.core.log('Default ENTER behavior.');\n\n            }\n\n        }\n\n        /** get all inputs after new appending block */\n        codex.ui.saveInputs();\n\n    };\n\n    callbacks.escapeKeyPressed = function(event){\n\n        /** Close all toolbar */\n        codex.toolbar.close();\n\n        /** Close toolbox */\n        codex.toolbar.toolbox.close();\n\n        event.preventDefault();\n\n    };\n\n    callbacks.arrowKeyPressed = function(event){\n\n        codex.content.workingNodeChanged();\n\n        /* Closing toolbar */\n        codex.toolbar.close();\n        codex.toolbar.move();\n\n    };\n\n    callbacks.defaultKeyPressed = function(event) {\n\n        codex.toolbar.close();\n\n        if (!codex.toolbar.inline.actionsOpened) {\n            codex.toolbar.inline.close();\n            codex.content.clearMark();\n        }\n    };\n\n    callbacks.redactorClicked = function (event) {\n\n        codex.content.workingNodeChanged(event.target);\n\n        codex.ui.saveInputs();\n\n        var selectedText = codex.toolbar.inline.getSelectionText();\n\n        /**\n         * If selection range took off, then we hide inline toolbar\n         */\n        if (selectedText.length === 0) {\n            codex.toolbar.inline.close();\n        }\n\n        /** Update current input index in memory when caret focused into existed input */\n        if (event.target.contentEditable == 'true') {\n\n            codex.caret.saveCurrentInputIndex();\n\n        }\n\n        if (codex.content.currentNode === null) {\n\n            /**\n             * If inputs in redactor does not exits, then we put input index 0 not -1\n             */\n            var indexOfLastInput = codex.state.inputs.length > 0 ? codex.state.inputs.length - 1 : 0;\n\n            /** If we have any inputs */\n            if (codex.state.inputs.length) {\n\n                /** getting firstlevel parent of input */\n                var firstLevelBlock  = codex.content.getFirstLevelBlock(codex.state.inputs[indexOfLastInput]);\n            }\n\n            /** If input is empty, then we set caret to the last input */\n            if (codex.state.inputs.length && codex.state.inputs[indexOfLastInput].textContent === '' && firstLevelBlock.dataset.tool == 'paragraph') {\n\n                codex.caret.setToBlock(indexOfLastInput);\n\n            } else {\n\n                /** Create new input when caret clicked in redactors area */\n                var NEW_BLOCK_TYPE = 'paragraph';\n\n                codex.content.insertBlock({\n                    type  : NEW_BLOCK_TYPE,\n                    block : codex.tools[NEW_BLOCK_TYPE].render()\n                });\n\n                /** If there is no inputs except inserted */\n                if (codex.state.inputs.length === 1) {\n\n                    codex.caret.setToBlock(indexOfLastInput);\n\n                } else {\n\n                    /** Set caret to this appended input */\n                    codex.caret.setToNextBlock(indexOfLastInput);\n                }\n            }\n\n            /**\n             * Move toolbar to the right position and open\n             */\n            codex.toolbar.move();\n\n\n            codex.toolbar.open();\n\n        } else {\n\n            /**\n             * Move toolbar to the new position and open\n             */\n            codex.toolbar.move();\n\n            codex.toolbar.open();\n\n            /** Close all panels */\n            codex.toolbar.settings.close();\n            codex.toolbar.toolbox.close();\n        }\n\n\n        var inputIsEmpty = !codex.content.currentNode.textContent.trim();\n\n        if (inputIsEmpty) {\n\n            /** Show plus button */\n            codex.toolbar.showPlusButton();\n\n        } else {\n\n            /** Hide plus buttons */\n            codex.toolbar.hidePlusButton();\n\n        }\n\n        var currentNodeType = codex.content.currentNode.dataset.tool;\n\n        /** Mark current block*/\n        if (currentNodeType != 'paragraph' || !inputIsEmpty) {\n\n            codex.content.markBlock();\n\n        }\n\n    };\n\n    /**\n     * This method allows to define, is caret in contenteditable element or not.\n     * Otherwise, if we get TEXT node from range container, that will means we have input index.\n     * In this case we use default browsers behaviour (if plugin allows that) or overwritten action.\n     * Therefore, to be sure that we've clicked first-level block area, we should have currentNode, which always\n     * specifies to the first-level block. Other cases we just ignore.\n     */\n    callbacks.clickedOnFirstLevelBlockArea = function() {\n\n        var selection  = window.getSelection(),\n            anchorNode = selection.anchorNode,\n            flag = false;\n\n\n        if (selection.rangeCount == 0) {\n\n            return true;\n\n        } else {\n\n            if (!codex.core.isDomNode(anchorNode)) {\n                anchorNode = anchorNode.parentNode;\n            }\n\n            /** Already founded, without loop */\n            if (anchorNode.contentEditable == 'true') {\n                flag = true;\n            }\n\n            while (anchorNode.contentEditable != 'true') {\n                anchorNode = anchorNode.parentNode;\n\n                if (anchorNode.contentEditable == 'true') {\n                    flag = true;\n                }\n\n                if (anchorNode == document.body) {\n                    break;\n                }\n            }\n\n            /** If editable element founded, flag is \"TRUE\", Therefore we return \"FALSE\" */\n            return flag ? false : true;\n        }\n\n    };\n\n    /**\n     * Toolbar button click handler\n     * @param this - cursor to the button\n     */\n    callbacks.toolbarButtonClicked = function (event) {\n\n        var button = this;\n\n        codex.toolbar.current = button.dataset.type;\n\n        codex.toolbar.toolbox.toolClicked(event);\n        codex.toolbar.close();\n\n    };\n\n    callbacks.redactorInputEvent = function (event) {\n\n        /**\n         * Clear previous sync-timeout\n         */\n        if (this.redactorSyncTimeout){\n            clearTimeout(this.redactorSyncTimeout);\n        }\n\n        /**\n         * Start waiting to input finish and sync redactor\n         */\n        this.redactorSyncTimeout = setTimeout(function() {\n\n            codex.content.sync();\n\n        }, 500);\n\n    };\n\n    /** Show or Hide toolbox when plus button is clicked */\n    callbacks.plusButtonClicked = function() {\n\n        if (!codex.nodes.toolbox.classList.contains('opened')) {\n\n            codex.toolbar.toolbox.open();\n\n        } else {\n\n            codex.toolbar.toolbox.close();\n\n        }\n    };\n\n    /**\n     * Block handlers for KeyDown events\n     */\n    callbacks.blockKeydown = function(event, block) {\n\n        switch (event.keyCode){\n\n            case codex.core.keys.DOWN:\n            case codex.core.keys.RIGHT:\n                codex.callback.blockRightOrDownArrowPressed(block);\n                break;\n\n            case codex.core.keys.BACKSPACE:\n                codex.callback.backspacePressed(block);\n                break;\n\n            case codex.core.keys.UP:\n            case codex.core.keys.LEFT:\n                codex.callback.blockLeftOrUpArrowPressed(block);\n                break;\n\n        }\n    };\n\n    /**\n     * RIGHT or DOWN keydowns on block\n     */\n    callbacks.blockRightOrDownArrowPressed = function (block) {\n\n        var selection   = window.getSelection(),\n            inputs      = codex.state.inputs,\n            focusedNode = selection.anchorNode,\n            focusedNodeHolder;\n\n        /** Check for caret existance */\n        if (!focusedNode){\n            return false;\n        }\n\n        /** Looking for closest (parent) contentEditable element of focused node */\n        while (focusedNode.contentEditable != 'true') {\n\n            focusedNodeHolder = focusedNode.parentNode;\n            focusedNode       = focusedNodeHolder;\n        }\n\n        /** Input index in DOM level */\n        var editableElementIndex = 0;\n        while (focusedNode != inputs[editableElementIndex]) {\n            editableElementIndex ++;\n        }\n\n        /**\n         * Founded contentEditable element doesn't have childs\n         * Or maybe New created block\n         */\n        if (!focusedNode.textContent)\n        {\n            codex.caret.setToNextBlock(editableElementIndex);\n            return;\n        }\n\n        /**\n         * Do nothing when caret doesn not reaches the end of last child\n         */\n        var caretInLastChild    = false,\n            caretAtTheEndOfText = false;\n\n        var lastChild,\n            deepestTextnode;\n\n        lastChild = focusedNode.childNodes[focusedNode.childNodes.length - 1 ];\n\n        if (codex.core.isDomNode(lastChild)) {\n\n            deepestTextnode = codex.content.getDeepestTextNodeFromPosition(lastChild, lastChild.childNodes.length);\n\n        } else {\n\n            deepestTextnode = lastChild;\n\n        }\n\n        caretInLastChild = selection.anchorNode == deepestTextnode;\n        caretAtTheEndOfText = deepestTextnode.length == selection.anchorOffset;\n\n        if ( !caretInLastChild  || !caretAtTheEndOfText ) {\n            codex.core.log('arrow [down|right] : caret does not reached the end');\n            return false;\n        }\n\n        codex.caret.setToNextBlock(editableElementIndex);\n\n    };\n\n    /**\n     * LEFT or UP keydowns on block\n     */\n    callbacks.blockLeftOrUpArrowPressed = function (block) {\n\n        var selection   = window.getSelection(),\n            inputs      = codex.state.inputs,\n            focusedNode = selection.anchorNode,\n            focusedNodeHolder;\n\n        /** Check for caret existance */\n        if (!focusedNode){\n            return false;\n        }\n\n        /**\n         * LEFT or UP not at the beginning\n         */\n        if ( selection.anchorOffset !== 0) {\n            return false;\n        }\n\n        /** Looking for parent contentEditable block */\n        while (focusedNode.contentEditable != 'true') {\n            focusedNodeHolder = focusedNode.parentNode;\n            focusedNode       = focusedNodeHolder;\n        }\n\n        /** Input index in DOM level */\n        var editableElementIndex = 0;\n        while (focusedNode != inputs[editableElementIndex]) {\n            editableElementIndex ++;\n        }\n\n        /**\n         * Do nothing if caret is not at the beginning of first child\n         */\n        var caretInFirstChild   = false,\n            caretAtTheBeginning = false;\n\n        var firstChild,\n            deepestTextnode;\n\n        /**\n         * Founded contentEditable element doesn't have childs\n         * Or maybe New created block\n         */\n        if (!focusedNode.textContent) {\n            codex.caret.setToPreviousBlock(editableElementIndex);\n            return;\n        }\n\n        firstChild = focusedNode.childNodes[0];\n\n        if (codex.core.isDomNode(firstChild)) {\n\n            deepestTextnode = codex.content.getDeepestTextNodeFromPosition(firstChild, 0);\n\n        } else {\n\n            deepestTextnode = firstChild;\n\n        }\n\n        caretInFirstChild   = selection.anchorNode == deepestTextnode;\n        caretAtTheBeginning = selection.anchorOffset === 0;\n\n        if ( caretInFirstChild && caretAtTheBeginning ) {\n\n            codex.caret.setToPreviousBlock(editableElementIndex);\n\n        }\n\n    };\n\n    /**\n     * Callback for enter key pressing in first-level block area\n     */\n    callbacks.enterPressedOnBlock = function (event) {\n\n        var NEW_BLOCK_TYPE  = 'paragraph';\n\n        codex.content.insertBlock({\n            type  : NEW_BLOCK_TYPE,\n            block : codex.tools[NEW_BLOCK_TYPE].render()\n        }, true );\n\n        codex.toolbar.move();\n        codex.toolbar.open();\n\n    };\n\n    callbacks.backspacePressed = function (block) {\n\n        var currentInputIndex = codex.caret.getCurrentInputIndex(),\n            range,\n            selectionLength,\n            firstLevelBlocksCount;\n\n        if (block.textContent.trim()) {\n\n            range           = codex.content.getRange();\n            selectionLength = range.endOffset - range.startOffset;\n\n            if (codex.caret.position.atStart() && !selectionLength) {\n\n                codex.content.mergeBlocks(currentInputIndex);\n\n            } else {\n\n                return;\n\n            }\n        }\n\n        if (!selectionLength) {\n            block.remove();\n        }\n\n\n        firstLevelBlocksCount = codex.nodes.redactor.childNodes.length;\n\n        /**\n         * If all blocks are removed\n         */\n        if (firstLevelBlocksCount === 0) {\n\n            /** update currentNode variable */\n            codex.content.currentNode = null;\n\n            /** Inserting new empty initial block */\n            codex.ui.addInitialBlock();\n\n            /** Updating inputs state after deleting last block */\n            codex.ui.saveInputs();\n\n            /** Set to current appended block */\n            setTimeout(function () {\n\n                codex.caret.setToPreviousBlock(1);\n\n            }, 10);\n\n        } else {\n\n            if (codex.caret.inputIndex !== 0) {\n\n                /** Target block is not first */\n                codex.caret.setToPreviousBlock(codex.caret.inputIndex);\n\n            } else {\n\n                /** If we try to delete first block */\n                codex.caret.setToNextBlock(codex.caret.inputIndex);\n\n            }\n        }\n\n        codex.toolbar.move();\n\n        if (!codex.toolbar.opened) {\n            codex.toolbar.open();\n        }\n\n        /** Updating inputs state */\n        codex.ui.saveInputs();\n\n        /** Prevent default browser behaviour */\n        event.preventDefault();\n\n    };\n\n    callbacks.blockPaste = function(event) {\n\n        var currentInputIndex = codex.caret.getCurrentInputIndex(),\n            node = codex.state.inputs[currentInputIndex];\n\n        setTimeout(function() {\n\n            codex.content.sanitize(node);\n\n        }, 10);\n\n    };\n\n    callbacks._blockPaste = function(event) {\n\n        var currentInputIndex = codex.caret.getCurrentInputIndex();\n\n        /**\n         * create an observer instance\n         */\n        var observer = new MutationObserver(codex.callback.handlePasteEvents);\n\n        /**\n         * configuration of the observer:\n         */\n        var config = { attributes: true, childList: true, characterData: false };\n\n        // pass in the target node, as well as the observer options\n        observer.observe(codex.state.inputs[currentInputIndex], config);\n    };\n\n    /**\n     * Sends all mutations to paste handler\n     */\n    callbacks.handlePasteEvents = function(mutations) {\n        mutations.forEach(codex.content.paste);\n    };\n\n    /**\n     * Clicks on block settings button\n     */\n    callbacks.showSettingsButtonClicked = function(){\n\n        /**\n         * Get type of current block\n         * It uses to append settings from tool.settings property.\n         * ...\n         * Type is stored in data-type attribute on block\n         */\n        var currentToolType = codex.content.currentNode.dataset.tool;\n\n        codex.toolbar.settings.toggle(currentToolType);\n\n        /** Close toolbox when settings button is active */\n        codex.toolbar.toolbox.close();\n        codex.toolbar.settings.hideRemoveActions();\n\n    };\n\n    return callbacks;\n\n})({});\n\ncodex.callback = callbacks;\nmodule.exports  = callbacks;\n\n\n\n/** WEBPACK FOOTER **\n ** ./modules/callbacks.js\n **/","var codex = require('../editor');\n\nvar draw = (function(draw) {\n\n    /**\n     * Base editor wrapper\n     */\n    draw.wrapper = function () {\n\n        var wrapper = document.createElement('div');\n\n        wrapper.className += 'codex-editor';\n\n        return wrapper;\n\n    };\n\n    /**\n     * Content-editable holder\n     */\n    draw.redactor = function () {\n\n        var redactor = document.createElement('div');\n\n        redactor.className += 'ce-redactor';\n\n        return redactor;\n\n    };\n\n    draw.ceBlock = function() {\n\n        var block = document.createElement('DIV');\n\n        block.className += 'ce_block';\n\n        return block;\n\n    };\n\n    /**\n     * Empty toolbar with toggler\n     */\n    draw.toolbar = function () {\n\n        var bar = document.createElement('div');\n\n        bar.className += 'ce-toolbar';\n\n        return bar;\n    };\n\n    draw.toolbarContent = function() {\n\n        var wrapper = document.createElement('DIV');\n        wrapper.classList.add('ce-toolbar__content');\n\n        return wrapper;\n    };\n\n    /**\n     * Inline toolbar\n     */\n    draw.inlineToolbar = function() {\n\n        var bar = document.createElement('DIV');\n\n        bar.className += 'ce-toolbar-inline';\n\n        return bar;\n\n    };\n\n    /**\n     * Wrapper for inline toobar buttons\n     */\n    draw.inlineToolbarButtons = function() {\n\n        var wrapper = document.createElement('DIV');\n\n        wrapper.className += 'ce-toolbar-inline__buttons';\n\n        return wrapper;\n    };\n\n    /**\n     * For some actions\n     */\n    draw.inlineToolbarActions = function() {\n\n        var wrapper = document.createElement('DIV');\n\n        wrapper.className += 'ce-toolbar-inline__actions';\n\n        return wrapper;\n\n    };\n\n    draw.inputForLink = function() {\n\n        var input = document.createElement('INPUT');\n\n        input.type        = 'input';\n        input.className  += 'inputForLink';\n        input.placeholder = 'Type URL ...';\n        input.setAttribute('form', 'defaultForm');\n\n        input.setAttribute('autofocus', 'autofocus');\n\n        return input;\n\n    };\n\n    /**\n     * Block with notifications\n     */\n    draw.alertsHolder = function() {\n\n        var block = document.createElement('div');\n\n        block.classList.add('ce_notifications-block');\n\n        return block;\n\n    };\n\n    /**\n     * @todo Desc\n     */\n    draw.blockButtons = function() {\n\n        var block = document.createElement('div');\n\n        block.className += 'ce-toolbar__actions';\n\n        return block;\n    };\n\n    /**\n     * Block settings panel\n     */\n    draw.blockSettings = function () {\n\n        var settings = document.createElement('div');\n\n        settings.className += 'ce-settings';\n\n        return settings;\n    };\n\n    draw.defaultSettings = function() {\n\n        var div = document.createElement('div');\n\n        div.classList.add('ce-settings_default');\n\n        return div;\n    },\n\n    draw.pluginsSettings = function() {\n\n        var div = document.createElement('div');\n\n        div.classList.add('ce-settings_plugin');\n\n        return div;\n\n    };\n\n    draw.plusButton = function() {\n\n        var button = document.createElement('span');\n\n        button.className = 'ce-toolbar__plus';\n        // button.innerHTML = '<i class=\"ce-icon-plus\"></i>';\n\n        return button;\n    };\n\n    /**\n     * Settings button in toolbar\n     */\n    draw.settingsButton = function () {\n\n        var toggler = document.createElement('span');\n\n        toggler.className = 'ce-toolbar__settings-btn';\n\n        /** Toggler button*/\n        toggler.innerHTML = '<i class=\"ce-icon-cog\"></i>';\n\n        return toggler;\n    };\n\n    /**\n     * Redactor tools wrapper\n     */\n\n    draw.toolbox = function() {\n\n        var wrapper = document.createElement('div');\n\n        wrapper.className = 'ce-toolbar__tools';\n\n        return wrapper;\n    };\n\n    /**\n     * @protected\n     *\n     * Draws tool buttons for toolbox\n     *\n     * @param {String} type\n     * @param {String} classname\n     * @returns {Element}\n     */\n    draw.toolbarButton = function (type, classname) {\n\n        var button     = document.createElement(\"li\"),\n            tool_icon  = document.createElement(\"i\"),\n            tool_title = document.createElement(\"span\");\n\n        button.dataset.type = type;\n        button.setAttribute('title', type);\n\n        tool_icon.classList.add(classname);\n        tool_title.classList.add('ce_toolbar_tools--title');\n\n\n        button.appendChild(tool_icon);\n        button.appendChild(tool_title);\n\n        return button;\n\n    };\n\n    /**\n     * @protected\n     *\n     * Draws tools for inline toolbar\n     *\n     * @param {String} type\n     * @param {String} classname\n     */\n    draw.toolbarButtonInline = function(type, classname) {\n        var button     = document.createElement(\"BUTTON\"),\n            tool_icon  = document.createElement(\"I\");\n\n        button.type = \"button\";\n        button.dataset.type = type;\n        tool_icon.classList.add(classname);\n\n        button.appendChild(tool_icon);\n\n        return button;\n    };\n\n    /**\n     * Redactor block\n     */\n    draw.block = function (tagName, content) {\n\n        var node = document.createElement(tagName);\n\n        node.innerHTML = content || '';\n\n        return node;\n\n    };\n\n    /**\n     * Creates Node with passed tagName and className\n     * @param {string}  tagName\n     * @param {string} className\n     * @param {object} properties - allow to assign properties\n     */\n    draw.node = function( tagName , className , properties ){\n\n        var el = document.createElement( tagName );\n\n        if ( className ) el.className = className;\n\n        if ( properties ) {\n\n            for (var name in properties){\n                el[name] = properties[name];\n            }\n        }\n\n        return el;\n    };\n\n    draw.pluginsRender = function(type, content) {\n\n        return {\n            type  : type,\n            block : cEditor.tools[type].render({\n                text : content\n            })\n        };\n    };\n\n    return draw;\n\n})({});\n\ncodex.draw = draw;\n\nmodule.exports = draw;\n\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./modules/draw.js\n **/","var codex = require('../editor');\n\nvar caret = (function(caret) {\n\n    /**\n     * @var {int} InputIndex - editable element in DOM\n     */\n    caret.inputIndex = null;\n\n    /**\n     * @var {int} offset - caret position in a text node.\n     */\n    caret.offset = null;\n\n    /**\n     * @var {int} focusedNodeIndex - we get index of child node from first-level block\n     */\n    caret.focusedNodeIndex = null;\n\n    /**\n     * Creates Document Range and sets caret to the element.\n     * @protected\n     * @uses caret.save — if you need to save caret position\n     * @param {Element} el - Changed Node.\n     */\n    caret.set = function( el , index, offset) {\n\n        offset = offset || this.offset || 0;\n        index  = index  || this.focusedNodeIndex || 0;\n\n        var childs = el.childNodes,\n            nodeToSet;\n\n        if ( childs.length === 0 ) {\n\n            nodeToSet = el;\n\n        } else {\n\n            nodeToSet = childs[index];\n\n        }\n\n        /** If Element is INPUT */\n        if (el.tagName == 'INPUT') {\n            el.focus();\n            return;\n        }\n\n        if (codex.core.isDomNode(nodeToSet)) {\n\n            nodeToSet = codex.content.getDeepestTextNodeFromPosition(nodeToSet, nodeToSet.childNodes.length);\n        }\n\n        var range     = document.createRange(),\n            selection = window.getSelection();\n\n        setTimeout(function() {\n\n            range.setStart(nodeToSet, offset);\n            range.setEnd(nodeToSet, offset);\n\n            selection.removeAllRanges();\n            selection.addRange(range);\n\n            codex.caret.saveCurrentInputIndex();\n\n        }, 20);\n    };\n\n    /**\n     * @protected\n     * Updates index of input and saves it in caret object\n     */\n    caret.saveCurrentInputIndex = function () {\n\n        /** Index of Input that we paste sanitized content */\n        var selection   = window.getSelection(),\n            inputs      = codex.state.inputs,\n            focusedNode = selection.anchorNode,\n            focusedNodeHolder;\n\n        if (!focusedNode){\n            return;\n        }\n\n        /** Looking for parent contentEditable block */\n        while (focusedNode.contentEditable != 'true') {\n            focusedNodeHolder = focusedNode.parentNode;\n            focusedNode       = focusedNodeHolder;\n        }\n\n        /** Input index in DOM level */\n        var editableElementIndex = 0;\n\n        while (focusedNode != inputs[editableElementIndex]) {\n            editableElementIndex ++;\n        }\n\n        this.inputIndex = editableElementIndex;\n    };\n\n    /**\n     * Returns current input index (caret object)\n     */\n    caret.getCurrentInputIndex = function() {\n        return this.inputIndex;\n    };\n\n    /**\n     * @param {int} index - index of first-level block after that we set caret into next input\n     */\n    caret.setToNextBlock = function(index) {\n\n        var inputs = codex.state.inputs,\n            nextInput = inputs[index + 1];\n\n        if (!nextInput) {\n            codex.core.log('We are reached the end');\n            return;\n        }\n\n        /**\n         * When new Block created or deleted content of input\n         * We should add some text node to set caret\n         */\n        if (!nextInput.childNodes.length) {\n            var emptyTextElement = document.createTextNode('');\n            nextInput.appendChild(emptyTextElement);\n        }\n\n        codex.caret.inputIndex = index + 1;\n        codex.caret.set(nextInput, 0, 0);\n        codex.content.workingNodeChanged(nextInput);\n\n    };\n\n    /**\n     * @param {int} index - index of target input.\n     * Sets caret to input with this index\n     */\n    caret.setToBlock = function(index) {\n\n        var inputs = codex.state.inputs,\n            targetInput = inputs[index];\n\n        console.assert( targetInput , 'caret.setToBlock: target input does not exists');\n\n        if ( !targetInput ) {\n            return;\n        }\n\n        /**\n         * When new Block created or deleted content of input\n         * We should add some text node to set caret\n         */\n        if (!targetInput.childNodes.length) {\n            var emptyTextElement = document.createTextNode('');\n            targetInput.appendChild(emptyTextElement);\n        }\n\n        codex.caret.inputIndex = index;\n        codex.caret.set(targetInput, 0, 0);\n        codex.content.workingNodeChanged(targetInput);\n\n    };\n\n    /**\n     * @param {int} index - index of input\n     */\n    caret.setToPreviousBlock = function(index) {\n\n        index = index || 0;\n\n        var inputs = codex.state.inputs,\n            previousInput = inputs[index - 1],\n            lastChildNode,\n            lengthOfLastChildNode,\n            emptyTextElement;\n\n\n        if (!previousInput) {\n            codex.core.log('We are reached first node');\n            return;\n        }\n\n        lastChildNode = codex.content.getDeepestTextNodeFromPosition(previousInput, previousInput.childNodes.length);\n        lengthOfLastChildNode = lastChildNode.length;\n\n        /**\n         * When new Block created or deleted content of input\n         * We should add some text node to set caret\n         */\n        if (!previousInput.childNodes.length) {\n\n            emptyTextElement = document.createTextNode('');\n            previousInput.appendChild(emptyTextElement);\n        }\n        codex.caret.inputIndex = index - 1;\n        codex.caret.set(previousInput, previousInput.childNodes.length - 1, lengthOfLastChildNode);\n        codex.content.workingNodeChanged(inputs[index - 1]);\n    };\n\n    caret.position = {\n\n        atStart : function() {\n\n            var selection       = window.getSelection(),\n                anchorOffset    = selection.anchorOffset,\n                anchorNode      = selection.anchorNode,\n                firstLevelBlock = codex.content.getFirstLevelBlock(anchorNode),\n                pluginsRender   = firstLevelBlock.childNodes[0];\n\n            if (!codex.core.isDomNode(anchorNode)) {\n                anchorNode = anchorNode.parentNode;\n            }\n\n            var isFirstNode  = anchorNode === pluginsRender.childNodes[0],\n                isOffsetZero = anchorOffset === 0;\n\n            return isFirstNode && isOffsetZero;\n\n        },\n\n        atTheEnd : function() {\n\n            var selection    = window.getSelection(),\n                anchorOffset = selection.anchorOffset,\n                anchorNode   = selection.anchorNode;\n\n            /** Caret is at the end of input */\n            return !anchorNode || !anchorNode.length || anchorOffset === anchorNode.length;\n        }\n    };\n\n    return caret;\n\n})({});\n\ncodex.caret = caret;\nmodule.exports = caret;\n\n\n/** WEBPACK FOOTER **\n ** ./modules/caret.js\n **/","var codex = require('../editor');\n\nvar notifications = (function(notifications) {\n\n    /**\n     * Error notificator. Shows block with message\n     * @protected\n     */\n    notifications.errorThrown = function(errorMsg, event) {\n\n        codex.notifications.send('This action is not available currently', event.type, false);\n\n    },\n\n    /**\n     * Appends notification with different types\n     * @param message {string} - Error or alert message\n     * @param type {string} - Type of message notification. Ex: Error, Warning, Danger ...\n     * @param append {boolean} - can be True or False when notification should be inserted after\n     */\n    notifications.send = function(message, type, append) {\n\n        var notification = codex.draw.block('div');\n\n        notification.textContent = message;\n        notification.classList.add('ce_notification-item', 'ce_notification-' + type, 'flipInX');\n\n        if (!append) {\n            codex.nodes.notifications.innerHTML = '';\n        }\n\n        codex.nodes.notifications.appendChild(notification);\n\n        setTimeout(function () {\n            notification.remove();\n        }, 3000);\n\n    };\n\n    return notifications;\n\n})({});\n\ncodex.notifications = notifications;\nmodule.exports = notifications;\n\n\n/** WEBPACK FOOTER **\n ** ./modules/notifications.js\n **/","var codex = require('../editor');\n\nvar parser = (function(parser) {\n\n    parser.init = function() {\n\n    };\n\n    /**\n     * Splits content by `\\n` and returns blocks\n     */\n    parser.getSeparatedTexttSeparatedTextFromContent = function(content) {\n        return content.split('\\n');\n    };\n\n    /** inserting text */\n    parser.insertPastedContent = function(content) {\n\n        var blocks = this.getSeparatedTextFromContent(content),\n            i,\n            inputIndex = cEditor.caret.getCurrentInputIndex(),\n            textNode,\n            parsedTextContent;\n\n        for(i = 0; i < blocks.length; i++) {\n\n            blocks[i].trim();\n\n            if (blocks[i]) {\n                var data = cEditor.draw.pluginsRender('paragraph', blocks[i]);\n                cEditor.content.insertBlock(data);\n            }\n        }\n\n    };\n\n    /**\n     * Asynchronously parses textarea input string to HTML editor blocks\n     */\n    parser.parseTextareaContent = function () {\n\n        var initialContent = cEditor.nodes.textarea.value;\n\n        if ( initialContent.trim().length === 0 ) return true;\n\n\n        cEditor.parser\n\n        /** Get child nodes async-aware */\n            .getNodesFromString(initialContent)\n\n            /** Then append nodes to the redactor */\n            .then(cEditor.parser.appendNodesToRedactor)\n\n            /** Write log if something goes wrong */\n            .catch(function(error) {\n                cEditor.core.log('Error while parsing content: %o', 'warn', error);\n            });\n\n    };\n\n    /**\n     * Parses string to nodeList\n     * @param string inputString\n     * @return Primise -> nodeList\n     */\n    parser.getNodesFromString = function (inputString) {\n\n        return Promise.resolve().then(function() {\n\n            var contentHolder = document.createElement('div');\n\n            contentHolder.innerHTML = inputString;\n\n            /**\n             *    Returning childNodes will include:\n             *        - Elements (html-tags),\n             *        - Texts (empty-spaces or non-wrapped strings )\n             *        - Comments and other\n             */\n            return contentHolder.childNodes;\n\n        });\n    };\n\n    /**\n     * Appends nodes to the redactor\n     * @param nodeList nodes - list for nodes to append\n     */\n    parser.appendNodesToRedactor = function(nodes) {\n\n        /**\n         * Sequence of one-by-one nodes appending\n         * Uses to save blocks order after async-handler\n         */\n        var nodeSequence = Promise.resolve();\n\n\n        for (var index = 0; index < nodes.length ; index++ ) {\n\n            /** Add node to sequence at specified index */\n            cEditor.parser.appendNodeAtIndex(nodeSequence, nodes, index);\n\n        }\n\n    };\n\n    /**\n     * Append node at specified index\n     */\n    parser.appendNodeAtIndex = function (nodeSequence, nodes, index) {\n\n        /** We need to append node to sequence */\n        nodeSequence\n\n        /** first, get node async-aware */\n            .then(function() {\n\n                return cEditor.parser.getNodeAsync(nodes , index);\n\n            })\n\n            /**\n             *    second, compose editor-block from node\n             *    and append it to redactor\n             */\n            .then(function(node){\n\n                var block = cEditor.parser.createBlockByDomNode(node);\n\n                if ( cEditor.core.isDomNode(block) ) {\n\n                    block.contentEditable = \"true\";\n\n                    /** Mark node as redactor block*/\n                    block.classList.add('ce-block');\n\n                    /** Append block to the redactor */\n                    cEditor.nodes.redactor.appendChild(block);\n\n                    /** Save block to the cEditor.state array */\n                    cEditor.state.blocks.push(block);\n\n                    return block;\n\n                }\n                return null;\n            })\n\n            .then(cEditor.ui.addBlockHandlers)\n\n            /** Log if something wrong with node */\n            .catch(function(error) {\n                cEditor.core.log('Node skipped while parsing because %o', 'warn', error);\n            });\n\n    };\n\n    /**\n     * Asynchronously returns node from nodeList by index\n     * @return Promise to node\n     */\n    parser.getNodeAsync = function (nodeList, index) {\n\n        return Promise.resolve().then(function() {\n\n            return nodeList.item(index);\n\n        });\n    };\n\n    /**\n     * Creates editor block by DOM node\n     *\n     * First-level blocks (see cEditor.settings.blockTags) saves as-is,\n     * other wrapps with <p>-tag\n     *\n     * @param DOMnode node\n     * @return First-level node (paragraph)\n     */\n    parser.createBlockByDomNode = function (node) {\n\n        /** First level nodes already appears as blocks */\n        if ( cEditor.parser.isFirstLevelBlock(node) ){\n\n            /** Save plugin type in data-type */\n            node = this.storeBlockType(node);\n\n            return node;\n        }\n\n        /** Other nodes wraps into parent block (paragraph-tag) */\n        var parentBlock,\n            nodeContent     = node.textContent.trim(),\n            isPlainTextNode = node.nodeType != cEditor.core.nodeTypes.TAG;\n\n\n        /** Skip empty textNodes with space-symbols */\n        if (isPlainTextNode && !nodeContent.length) return null;\n\n        /** Make <p> tag */\n        parentBlock = cEditor.draw.block('P');\n\n        if (isPlainTextNode){\n            parentBlock.textContent = nodeContent.replace(/(\\s){2,}/, '$1'); // remove double spaces\n        } else {\n            parentBlock.appendChild(node);\n        }\n\n        /** Save plugin type in data-type */\n        parentBlock = this.storeBlockType(parentBlock);\n\n        return parentBlock;\n\n    };\n\n    /**\n     * It's a crutch\n     * - - - - - - -\n     * We need block type stored as data-attr\n     * Now supports only simple blocks : P, HEADER, QUOTE, CODE\n     * Remove it after updating parser module for the block-oriented structure:\n     *       - each block must have stored type\n     * @param {Element} node\n     */\n    parser.storeBlockType = function (node) {\n\n        switch (node.tagName) {\n            case 'P' :          node.dataset.tool = 'paragraph'; break;\n            case 'H1':\n            case 'H2':\n            case 'H3':\n            case 'H4':\n            case 'H5':\n            case 'H6':          node.dataset.tool = 'header'; break;\n            case 'BLOCKQUOTE':  node.dataset.tool = 'quote'; break;\n            case 'CODE':        node.dataset.tool = 'code'; break;\n        }\n\n        return node;\n\n    };\n\n    /**\n     * Check DOM node for display style: separated block or child-view\n     */\n    parser.isFirstLevelBlock = function (node) {\n\n        return node.nodeType == cEditor.core.nodeTypes.TAG &&\n            node.classList.contains(cEditor.ui.className.BLOCK_CLASSNAME);\n\n    };\n\n    return parser;\n\n})({});\n\nparser.init();\n\ncodex.parser = parser;\nmodule.exports = parser;\n\n\n\n/** WEBPACK FOOTER **\n ** ./modules/parser.js\n **/"],"sourceRoot":""}